/*! Email Tracker uses the popular InboxSDK library (www.inboxsdk.com). InboxSDK is used by several large organizations:
*   Dropbox (https://chrome.google.com/webstore/detail/dropbox-for-gmail-beta/dpdmhfocilnekecfjgimjdeckachfbec)
*   HubSpot (https://chrome.google.com/webstore/detail/hubspot-sales/oiiaigjnkhngdbnoookogelabohpglmd)
*   Stripe (https://chrome.google.com/webstore/detail/stripe-for-gmail/dhnddbohjigcdbcfjdngilgkdcbjjhna)
*   Giphy (https://chrome.google.com/webstore/detail/giphy-for-gmail/andgibkjiikabclfdkecpmdkfanpdapf)
*   Clearbit (https://chrome.google.com/webstore/detail/clearbit-connect-supercha/pmnhcgfcafcnkbengdcanjablaabjplo)
* The use of the library is similar to using other popular javascript libraries like jQuery and Underscore
*
* The library allows us to load our application code from our server providing our users with fast updates and the ability quickly respond to bugs.
*/function Disconnected(){window.DISCONNECTED||(window.DISCONNECTED=1,window.emailtracker_elements.forEach(function(e){e.removeAttribute("data-emailtracker"),e.removeAttribute("emailtracker")}),document.querySelectorAll(".emailtracker,.emailtracker_thread_loaded,[data-emailtracker],[emailtracker]").forEach(function(e){e.removeAttribute("data-emailtracker"),e.classList.remove("emailtracker"),e.classList.remove("emailtracker_thread_loaded"),e.removeAttribute("emailtracker")}),document.querySelectorAll(".emailtracker_status").forEach(function(e){Xtion_elements_delete(e)}),document.documentElement.removeAttribute("data-emailtracker-initialized"),window.emailtracker_detector&&(clearInterval(window.emailtracker_detector),Detector_clear()))}window.emailtracker_elements=[],window.CONTENT=1,window.ENABLED=1,document.documentElement.setAttribute("data-emailtracker-initialized","1"),window.ACTIVATED=0,window.DISCONNECTED=0;var heartbeat_port=chrome.runtime.connect({name:"heartbeat_port"}),parse_response,google_inbox_url,inbox_index,is_on_search,state_load;function Tracker(e,r,o){(o=o||{}).interval=o.interval||1e3;var t=0,a=setInterval(function(){t++;try{e(function(n){!window.emailtracker_ini&&Email_valid(n)&&(window.emailtracker_ini=1,clearInterval(a),Storage_get("cache_emails",function(i){function t(a){var e,t=[];for(e in i)t.push(i[e]);Background_storage_set("email_ids",JSON.stringify(t)),Background_cookie_set("user",a,(new Date).getTime()/1e3+31536e3,function(){chrome.runtime.sendMessage({a:"activated"}),window.ACTIVATED=1;function e(){DISCONNECTED||(Background_storage_set("user",a),Background_cookie_set("user",a,(new Date).getTime()/1e3+31536e3),LOCATION_TRACKERS.forEach(function(e,t){0!=t&&Background_cookie_set("user",a,(new Date).getTime()/1e3+31536e3,null,{url:e})}),Background_cookie_set("user",a,(new Date).getTime()/1e3+31536e3,null,{url:"http://bitt.site"}),Background_cookie_set("user",a,(new Date).getTime()/1e3+31536e3,null,{url:"http://bitli.pro"}),Background_cookie_set("user",a,(new Date).getTime()/1e3+31536e3,null,{url:"http://shortened-link.com"}))}e(),window.addEventListener("focus",e),setInterval(function(){if(!window.DISCONNECTED)try{Storage_get("cache_email_"+a+"_aliases",function(e){var i=[a],e=(e&&e.length&&i.concat(Object.values(e)),JSON.stringify(e));window.emailtracker_css_rules_hide_own_trackers!=e&&(window.emailtracker_css_rules_hide_own_trackers=e,Css_rule(window.LOCATION_TRACKERS_V.map(function(t){var a=[];return i.forEach(function(e){a.push('img[src*="'+t+"?u="+e+'"]')}),a.join(",")}).join(",")+"{display:none;}")),document.querySelectorAll(window.LOCATION_TRACKERS_V.map(function(e){return'img[src*="'+e+'?u"]'}).join(",")).forEach(function(t){i.forEach(function(e){t.src.indexOf("?u="+a+"&")}),0===t.naturalWidth&&t.naturalHeight})})}catch(e){~e.message.indexOf("context invalidated")&&Disconnected()}},1e3),setInterval(function(){window.DISCONNECTED||r(a,n)},o.interval)})}(i=i||{})[n]&&!isNaN(i[n])?t(i[n]):Request_background(LOCATION_ACTION+"user?e="+encodeURIComponent(n),function(e){e&&(i[n]=e,Storage_update("cache_emails",i,function(){t(e)}))})}))})}catch(e){}30<t&&(DISCONNECTED||clearInterval(a))},500)}function Tracker_email_alias_id(r,o,c){Storage_get("cache_emails",function(n){n=n||{},Storage_get("cache_email_"+r+"_aliases",function(i){i=i||{};function t(e){var t,a=[];for(t in n)a.push(n[t]);Background_storage_set("email_ids",JSON.stringify(a)),i[o]||(i[o]=e,Storage_update("cache_email_"+r+"_aliases",i)),c&&c(e)}n[o]&&!isNaN(n[o])?t(n[o]):Request_background(LOCATION_ACTION+"user?e="+encodeURIComponent(o),function(e){e&&(n[o]=e,Storage_update("cache_emails",n,function(){t(e)}))})})})}function Tracker_send(e,t){t&&window.emailtracker_elements.push(t),window.DISCONNECTED||1==window.ENABLED&&e()}function Tracker_insert(c,s,e,d,l,u){var m,_,p;u=u||{},s&&e?(m=function(){setTimeout(function(){e.setAttribute("data-emailtracker_loaded","1"),e.click(),e.removeAttribute("data-emailtracker_loaded")},0)},_=0,u.popup_loading_disable||Xtion_popup_loading({message:"Email Tracker Loading",cancel:function(){_=1,m(),Xtion_popup_close()}}),p=function(){u.popup_loading_disable||Xtion_popup_close()},Storage_get("settings",function(o){o=o||{},Storage_get("notify",function(t){Storage_get("tracking_links_disabled",function(r){Storage_get("tracking_disabled",function(e){e?(_=1,p(),m()):Request_background(LOCATION_ACTION+"email?id_user="+parseInt(c)+(t?"&notify="+parseInt(t.id)+"&notify_v="+encodeURIComponent(t.v):""),function(t){if(!_)try{var e,a,i,n=JSON.parse(t);Tracker_remove_previous(s,u.remove_previous_blank_src),s.insertAdjacentHTML("beforeend",'<img src="'+LOCATION_TRACKER_V+"?u="+(u.uid_alias||c)+"&e="+n.id+"&v="+n.v+'" alt="" width="0" height="0" style="width:2px;max-height:0;overflow:hidden"/>'+(o.tracking_pixels||"")),n.pro&&!r&&(u.remove_previous_blank_src?Element_textnodes(s).forEach(function(e){if(e.nodeValue){for(var t=0,a=e.parentNode;!t&&a;)"A"===a.tagName&&(t=1),a=a.parentNode;e.innerHTML=Autolinker.link(e.nodeValue,{stripPrefix:!1,email:!1,phone:!1,twitter:!1,mention:!1,hashtag:!1,stripTrailingSlash:!1,decodePercentEncoding:!1})}}):s.innerHTML=Autolinker.link(s.innerHTML,{stripPrefix:!1,email:!1,phone:!1,twitter:!1,mention:!1,hashtag:!1,stripTrailingSlash:!1,decodePercentEncoding:!1}),e=Array.prototype.slice.call(s.querySelectorAll("a")),a=[],i=[],e.forEach(function(e){e.getAttribute("href")&&0===e.href.indexOf("http://bitt.site/")&&(e.href=e.href.replace("http://bitt.site/","https://bitli.pro/")),e.getAttribute("href")&&0===e.href.indexOf("http://bitli.pro/")&&(e.href=e.href.replace("http://bitli.pro/","https://shortened-link.com/")),e.getAttribute("href")&&""!==e.getAttribute("href")&&0!==e.href.indexOf("mailto:")&&0!==e.href.indexOf("tel:")&&(i.push(e),a.push(e.href))}),a.length)?Request_background(LOCATION_ACTION+"email_links",function(t){if(!_){try{JSON.parse(t).forEach(function(e,t){i[t].href=e})}catch(e){Error_popup(102,"Link Tracking Error: "+e,t)}p(),l||m(),d(n,_),l&&m()}},{post:Xtion_object_merge(n,{links:a}),timeout:1e4,retry:3,error:function(e){p(),m(),Error_popup(103,"Link Tracker Server Connection Error: "+e)}}):(p(),l||m(),d(n,_),l&&m())}catch(e){p(),m(),Error_popup(100,e,JSON.stringify(e.stack)+" "+t)}},{timeout:1e4,retry:3,error:function(e){p(),m(),Error_popup(101,"Email Tracker Server Connection Error: "+e)}})})})})})):Error_popup(110,"Unknown Edge Case - Please Contact Us For a Fix",document.body.innerHTML)}function Tracker_remove_previous(e,t){Xtion_foreach(e.querySelectorAll(window.LOCATION_TRACKERS.map(function(e){return'img[src*="'+e+'"]'}).join(",")),function(e){t?e.removeAttribute("src"):Xtion_elements_delete(e)})}function Tracker_icon(e,t){t=t||{};function c(){document.querySelectorAll(".emailtracker_status.emailtracker_show").forEach(function(e){Xtion_elements_delete(e)})}function s(a,n,r){c();var o="emailtracker_show"+Uniqid(),e=document.createElement("div");e.className="emailtracker_status emailtracker_show",e.id=o,e.innerHTML=a.lastChild.outerHTML,document.body.appendChild(e),setTimeout(function(){var i,e,t=document.getElementById(o);t&&((i=t.firstChild).addEventListener("mouseleave",function(){c()}),i.addEventListener("mousemove",function(){this.setAttribute("data-focused","1")}),i.style.opacity=1,i.style.top=n.clientY+"px",i.style.left=n.clientX+"px",i.style.marginLeft=n.clientX+i.clientWidth>window.innerWidth?15-i.clientWidth+"px":"-15px",i.style.marginTop=n.clientY+i.clientHeight>window.innerHeight?10-i.clientHeight+"px":"-10px",Math.abs(i.style.marginTop.replace("px",""))>i.style.top.replace("px","")&&(i.style.marginTop="-"+i.style.top),r&&((e=t.querySelector(".emailtracker_status_unread"))&&(e.onclick=function(){confirm("Are you sure you want to mark this email tracker as unread? This is used for false positives or notification of the next view.")&&(Request_background(LOCATION_ACTION+"email_unread?id_source="+encodeURIComponent(r)),a.innerHTML="&#9679;",c(),Storage_get("cache_opened_"+window.emailtracker_uid,function(e){delete(e=e||{})[r],Storage_update("cache_opened_"+window.emailtracker_uid,e)}))}),(e=t.querySelector(".emailtracker_status_print"))&&(e.onclick=function(){Storage_get("feed_info",function(a){window.open(LOCATION_MAIN+"user/email_report.php?id_source="+encodeURIComponent(r)+"&info="+encodeURIComponent(a[r]?JSON.stringify(["subject","timestamp","email","from","to"].reduce((e,t)=>(e[t]=a[r][t],e),{})):""))})}),e=t.querySelector(".emailtracker_status_unmute"))&&(e.onclick=function(){var a=this;Storage_get("feed_mute",function(e){var t=(e=e||[]).indexOf(r);~t&&(e.splice(t,1),Storage_update("feed_mute",e),a.innerHTML="Unmuted | &nbsp;")})}),setTimeout(function(){var a=function(e){if(window.removeEventListener("mousemove",a),!i.getAttribute("data-focused")){for(var t=e.target;t.parentNode;){if(t===i)return;t=t.parentNode}c()}};window.addEventListener("mousemove",a)},500))},50)}var a=setInterval(function(){var c=document.getElementById(e.id_source);c&&(clearInterval(a),c.setAttribute("data-id",c.id),c.id="",c.addEventListener("mouseenter",function(r){var o=this.lastChild;s(c,r,this.getAttribute("data-id")),setTimeout(function(){var n;o.getAttribute("data-emailtracker")||(o.setAttribute("data-emailtracker","1"),"1"===c.getAttribute("data-status")&&(n=o.parentNode.getAttribute("data-id"),Request_background(LOCATION_ACTION+"email_views?id_source="+encodeURIComponent(n)+"&unread=1",function(i){var e;i?(i=JSON.parse(i),Storage_get(["settings","feed_mute"],function(e){function t(e){e.stopPropagation()}var a=e.settings||{};i instanceof Array?o.innerHTML='<span><strong><span data-emailtracker-click-debug="'+Xtion_html_special_chars(n)+'">'+i.length+" View"+(1===i.length?"":"s")+" / Click"+(1===i.length?"":"s")+'</span> <a href="javascript:" class="emailtracker_status_print">&nbsp; | Print</a> <a href="javascript:" class="emailtracker_status_unread">Mark Unread</a>'+(e.feed_mute instanceof Array&&~e.feed_mute.indexOf(n)?' <a href="javascript:" class="emailtracker_status_unmute">Unmute | &nbsp;</a>':"")+"</strong>"+Tracker_parse_email_views(i,a)+"</span>":o.innerHTML='<span style="text-align:center;font-weight:700"><span data-emailtracker-click-debug="'+Xtion_html_special_chars(n)+'">'+i.views+" view"+(1==i.views?"":"s, last seen")+"</span> <time>"+Moment_date_pretty(moment.unix(i.last))+'</time><br/><a href="'+LOCATION_MAIN+'pro?source=inbox_read_report" target="_blank"><img alt="Upgrade to Pro to see the full Read Report" src="'+chrome.runtime.getURL("image/upgrade.jpg")+'"/></a>'+(e.feed_mute instanceof Array&&~e.feed_mute.indexOf(n)?'<br/><a href="javascript:" class="emailtracker_status_unmute">Unmute Notifications</a>':"")+"</span>";o.addEventListener("click",t,!1),o.addEventListener("mousedown",t,!1),o.addEventListener("dblclick",t,!1),o.addEventListener("contextmenu",t,!1),s(c,r,o.parentNode.getAttribute("data-id")),setTimeout(function(){Storage_get(["feed","feed_unopened"],function(a){var t=i.views||i.length;a.feed=a.feed.filter(function(e){return e}),a.feed_unopened=a.feed_unopened.filter(function(e){return e}),(a.feed_unopened||[]).forEach(function(e,t){a.feed_unopened[t].unopened=1,a.feed_unopened[t].unopened_key=t}),(a.feed||[]).concat(a.feed_unopened||[]).forEach(function(e){e&&e.id_source===n&&e.views!=t&&(e.views=t,e.time=i.last||i[0].timestamp,e.unopened&&(a.feed_unopened.splice(e.unopened_key,1),Storage_update("feed_unopened",a.feed_unopened),delete e.unopened,delete e.unopened_key,a.feed.push(e)),Storage_update("feed",a.feed))})})},0)})):(o.innerHTML="<span>Error. Please contact us for help.</span>",o.addEventListener("click",e=function(e){e.stopPropagation()},!1),o.addEventListener("mousedown",e,!1),o.addEventListener("dblclick",e,!1),o.addEventListener("contextmenu",e,!1),s(c,r,o.parentNode.getAttribute("data-id")))})))},100)}))},500);return window.emailtracker_inline_events||(window.emailtracker_inline_events=setInterval(function(){document.querySelectorAll("[data-emailtracker-click-stoppropagation]").forEach(function(e){e.onclick||(e.onclick=function(){window.event.stopPropagation()})}),document.querySelectorAll("[data-emailtracker-click-debug]").forEach(function(e){e.onclick||(e.onclick=function(){4===window.event.detail&&prompt("Copy the email debug information below and send to us when necessary:",this.getAttribute("data-emailtracker-click-debug"))})})},500)),"<"+(t.tag||"span")+' tabindex="0" data-status="'+parseInt(e.status)+'" id="'+e.id_source+'"'+(t.style?' style="'+t.style+'"':"")+(t.attributes?" "+t.attributes:"")+' class="emailtracker_status'+(t.class?" "+t.class:"")+'">'+(1==e.status?"&#10003;":"&#9679;")+(1==e.status?'<span style="display:none"><span><img alt="Loading.." src="'+chrome.runtime.getURL("image/loading.gif")+'"/></span></span>'+(t.tag?"</"+t.tag+">":"</span>")+"</span>":'<span style="display:none" data-emailtracker-click-stoppropagation><span style="padding:15px;text-align:center;"><strong data-emailtracker-click-debug="'+Xtion_html_special_chars(e.id_source)+'">Email Tracker Not Yet Read</strong><p style="width:400px;margin: 10px 0!important;white-space:normal;">Refresh the page to get updated tracking statuses. If the recipients email client blocks images the tracking will not be able to detect if the recipient opened the email.'+(~location.href.indexOf("mail.google.com")?"":" If you open your own email with email tracker it will not become read, to test the extension send to another email account.")+'</p><a href="'+LOCATION_MAIN+'help" target="_blank">click here for more details &amp; help</a></span></span>'+(t.tag?"</"+t.tag+">":"</span>"))}function Tracker_feed_info_insert(t,e,a,i,n,r,o){Storage_get("feed_info",function(e){(e=e||{})[i]={email:a,id:t.id,subject:n,link:r,to:o,timestamp:(new Date).getTime()/1e3},Storage_update("feed_info",e)}),Storage_get("feed_unopened",function(e){(e=e||[]).push({id:t.id,id_source:i,user:a}),Storage_update("feed_unopened",e)}),t.pro&&Request_background(LOCATION_ACTION+"email_information",null,{post:{id:t.id,v:t.v,uid:e,email:a,subject:n,link:r,to:o.join(", ")}})}function Detector_initialize(i,e){Detector_config(function(e){var a;DEBUG&&console.log("Email Tracker Detector Config",e),window.emailtracker_detector_service=window.emailtracker_detector_service||i,i=window.emailtracker_detector_service,window.emailtracker_detector_service&&(a={gmail:{emails:window.location.search.includes("view=lg")?".bodycontainer":"div.adn.ads, div.gA.gt:not(.acV)",insert:window.location.search.includes("view=lg")?"table.message td":"h3.iw"},outlook:{emails:'[id^="UniqueMessageBody"]',insert:'[data-testid="SentReceivedSavedTime"]'},yahoo:{emails:'[data-test-id="message-view-body"]',insert:'[data-test-id="with-contact-card-anchor"]'}}[window.emailtracker_detector_service],window.emailtracker_detector_config=e,Detector_clear(),"outlook"===i&&1==e.block&&(chrome.runtime.sendMessage({a:"outlook_tab_disable_images",owa:0===location.pathname.indexOf("/owa/")}),Script_inject(chrome.runtime.getURL("lib/outlook2_disable_serviceworkers.js")),setInterval(function(){var e=document.querySelectorAll(a.emails);document.querySelectorAll("img[src]:not([data-emailtracker-detector-blocker-whitelist-images]),td:not([data-emailtracker-detector-blocker-whitelist-images]),div:not([data-emailtracker-detector-blocker-whitelist-images]),[background]:not([data-emailtracker-detector-blocker-whitelist-images])").forEach(function(t){t.setAttribute("data-emailtracker-detector-blocker-whitelist-images","1");var a=0;e.forEach(function(e){e.contains(t)&&(a=1)}),a||Detector_whitelist_image(t,emailtracker_detector_config.whitelist_url_string)})},500)),window.emailtracker_detector||1!=emailtracker_detector_config.detector?0==emailtracker_detector_config.detector&&window.emailtracker_detector&&clearInterval(window.emailtracker_detector):(window.emailtracker_detector=setInterval(function(){try{var g,h,k;window.DISCONNECTED||(g=[],h=[],k=0,document.querySelectorAll(a.emails).forEach(function(e){var t,n,r,o;e.querySelectorAll("img[src],td,div,[background]").forEach(function(e){if(!e.getAttribute("data-emailtracker-detector")){e.setAttribute("data-emailtracker-detector","1");var a=Detector_element_src(e);if(("outlook"===window.emailtracker_detector_service||a.includes("googleusercontent.com/proxy")||a.includes("googleusercontent.com/meips")||a.includes("yusercontent.com"))&&!a.includes(emailtracker_detector_config.whitelist_url_string)){a.includes("yusercontent.com")&&(a=Detector_proxied_url(a));var t=!1,i=0;if(window.emailtracker_uids&&window.emailtracker_uids.forEach(function(e){e&&(a.includes("my-email-signature.link/signature.gif?u="+e+"&")||a.includes("email-signature-image.com/signature.gif?u="+e+"&"))&&(i=1)}),i)t={name:"Your Email Tracker "+(a.includes(".gif?self&u")?"(Allowed - trackers sent only to yourself)":"(Blocked to prevent opens on your own emails)"),whitelisted:a.includes(".gif?self&u"),self_tracker:1,detect:"Email Tracker Self UID Match"},a.includes(".gif?self&u")&&k++;else{var n,r,o,c,s,d,l,u,m,_=0,p=[];if(emailtracker_detector_config.rules&&emailtracker_detector_config.rules.forEach(function(e){var t;1==e.type?(t={name:e.name+" Allowed",custom:1,whitelisted:1,detect:e.search_value},(0==e.search_type&&a.includes(e.search_value)||1==e.search_type&&a.match(e.search_value))&&(_=t)):p.push({name:e.name,custom:1,[0==e.search_type?"search":"regex"]:e.search_value})}),_)g.push(e),h.push(_);else{e:for(var f of 0==emailtracker_detector_config.block_type?p:emailtracker_detector_blacklist.concat(p))if(!t){if(f.search)if(Array.isArray(f.search)){for(n of f.search)if(a.includes(n)){(t=f).detect=n;break e}}else if(a.includes(f.search)){t=f;break}if(f.regex)if(Array.isArray(f.regex)){for(n of f.regex)if(a.match(n)){(t=f).detect=n;break e}}else if(a.match(f.regex)){t=f;break}}emailtracker_detector_config.hasOwnProperty("block_type")&&emailtracker_detector_config.block_type&&2!=emailtracker_detector_config.block_type||t||(r=(m=function(e){return""!==e?parseInt(e,10):-1})(e.style.width),o=m(e.style.maxWidth),c=m(e.style.minWidth),s=e.getAttribute("width")?m(e.getAttribute("width")):-1,d=m(e.style.height),l=m(e.style.maxHeight),u=m(e.style.minHeight),m=e.getAttribute("height")?m(e.getAttribute("height")):-1,0!=r&&1!=r&&0!=o&&1!=o&&0!=c&&1!=c&&0!=s&&1!=s||0!=d&&1!=d&&0!=l&&1!=l&&0!=u&&1!=u&&0!=m&&1!=m?1<r||1<o||1<c||1<s||1<d||1<l||1<u||1<m||a.match("^.*[^.]{6}$")&&(t={detect:"No Dimensions Defined & No Proper File Extension"}):t={detect:"Dimensions"})}}t?(r=!!DEBUG&&!!document.querySelector('div.adn.ads [email="info@emailtracker.website"],div.adn.ads [email="emailtrackerextension@gmail.com"],div.adn.ads [email="testingemailtrackerext@gmail.com"]'),(~a.indexOf("my-email-signature.link")||~a.indexOf("email-signature-image.com"))&&r?(g.push(e),h.push({name:"Email Tracker",whitelisted:1,detect:"Email Tracker Support Allow"}),Detector_whitelist_image(e,emailtracker_detector_config.whitelist_url_string,1),k++):(g.push(e),h.push(t))):Detector_whitelist_image(e,emailtracker_detector_config.whitelist_url_string)}else(a.includes("my-email-signature.link/signature.gif?self&u=")||a.includes("https://email-signature-image.com/signature.gif?self&u="))&&(g.push(e),h.push({name:"Your Email Tracker (Allowed - you can trigger opens on emails sent only to yourself)",whitelisted:1,self_tracker:1,detect:"Email Tracker Self URL Match"}),k++)}}),g.length&&(DEBUG&&console.log("Email Tracker Detector trackingImages",g),e.querySelectorAll(".emailtracker_detector_icon,.emailtracker_detector_icon_popover_container").forEach(function(e){Xtion_elements_delete(e)}),(t=document.createElement("div")).className="emailtracker_detector_icon",(n=document.createElement("a")).href="javascript:",n.textContent="ᯤ",k===g.length?n.style.color="#090":1==emailtracker_detector_config.block&&(n.style.color="#f00"),t.appendChild(n),r=(r="")+('<div class="emailtracker_detector_icon_popover"><div><strong>'+g.length+" Email Tracker"+(1<g.length?"s":"")+" Detected ("+(1==emailtracker_detector_config.block?g.length-k:0)+" Blocked)</strong>"+(1==emailtracker_detector_config.block&&0<g.length-k?' <button class="emailtracker_detector_unblock_all">Unblock All</button>':"")+'<span style="padding-left:5px;display:inline-block;vertical-align:top;float:right"><a href="javascript:" title="Toggle Email Tracker Blocking On or Off" style="vertical-align:middle;text-decoration:none;color:'+(1==emailtracker_detector_config.block?"#090":"#900")+'" class="emailtracker_icon_hover_opacity">Email Tracker Blocking '+(1==emailtracker_detector_config.block?"Enabled":"Disabled")+'</a> <a href="#" title="Settings" class="emailtracker_icon_hover_opacity"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:17px;height:17px;margin-top:-2px;vertical-align:middle"><path d="M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"/></svg></a> <a href="'+LOCATION_MAIN)+'help/emailtracker-detector-and-blocker" target="_blank" title="Help" class="emailtracker_icon_help">?</a></span></div><ul>',g.forEach(function(e,t){var e=Detector_proxied_url(Detector_element_src(e)),a=h[t],t=(a.self_tracker||1!=emailtracker_detector_config.block?"":" "+(a.whitelisted?"(Allowed / Whitelisted)":'<span class="emailtracker_detector_status_blocked">(Blocked) <button data-emailtracker-detector-unblock="'+t+'">Unblock</button></span>'))+(a.custom?" (Matched Your Custom Rule)":"")+(DEBUG?" ("+(a.detect||a.search||a.regex)+")":"");r=(r=(r+='<li style="background:'+(!a.whitelisted&&1==emailtracker_detector_config.block?"#fec8c8":"")+'">')+(a.url?'<a href="'+a.url+'" title="'+a.url+'" target="_blank">':"")+(a.name||"Unknown")+("Email Tracker"===a.name||a.self_tracker?"":" Email Tracker")+(a.url?"</a>":"")+t+"<br/>")+'<a href="'+e+'" title="'+e+'" target="_blank" style="font-style:italic">'+e+"</a></li>"}),r+="</ul></div>",o=function(){document.querySelectorAll(".emailtracker_detector_icon_popover_container").forEach(function(e){Xtion_elements_delete(e)})},t.addEventListener("mouseenter",function(e){o();const i=document.createElement("div");i.className="emailtracker_detector_icon_popover_container",i.style.display="none",i.innerHTML=r,i.style.display="block",i.style.opacity="0",i.style.top=e.clientY+"px",i.style.left=e.clientX+"px",document.body.appendChild(i),setTimeout(function(){i.style.opacity="1",i.style.marginLeft=e.clientX+i.clientWidth>window.innerWidth?15-i.clientWidth+"px":"-15px",i.style.marginTop=e.clientY+i.clientHeight>window.innerHeight?10-i.clientHeight+"px":"-10px",Math.abs(i.style.marginTop.replace("px",""))>i.style.top.replace("px","")&&(i.style.marginTop="-"+i.style.top),i.addEventListener("mouseleave",function(){o()}),i.addEventListener("mousemove",function(){this.setAttribute("data-focused","1")}),setTimeout(function(){var a=function(e){if(window.removeEventListener("mousemove",a),!i.getAttribute("data-focused")){for(var t=e.target;t.parentNode;){if(t===i)return;t=t.parentNode}o()}};window.addEventListener("mousemove",a)},500)},50),i.querySelectorAll(".emailtracker_icon_hover_opacity").forEach(function(e){e.addEventListener("click",function(e){chrome.runtime.sendMessage({a:"detector_options_page"})})}),i.querySelectorAll(".emailtracker_detector_unblock_all").forEach(function(e){e.addEventListener("click",function(e){g.forEach(function(e){Detector_whitelist_image(e,emailtracker_detector_config.whitelist_url_string)}),document.querySelectorAll(".emailtracker_detector_status_blocked").forEach(function(e){e.innerText="(Allow All)",e.parentElement.style.background="",n.style.color="#090"})})}),i.querySelectorAll("[data-emailtracker-detector-unblock]").forEach(function(a){a.addEventListener("click",function(e){var t=this.getAttribute("data-emailtracker-detector-unblock");Detector_whitelist_image(g[t],emailtracker_detector_config.whitelist_url_string),a.parentElement.parentElement.style.background="",a.parentElement.innerText="(Allowed)",n.style.color="#090"})})}),(e=Xtion_parents(Xtion_parents(e,"gmail"===i?0:2).querySelector(a.insert),"yahoo"===i?1:0)).querySelector(".emailtracker_detector_icon")||e.appendChild(t))}))}catch(e){console.error("Email Tracker Detector Error",e)}},850),"gmail"===i&&location.search.includes("view=pt")&&document.querySelectorAll("img[src],td,div,[background]").forEach(function(e){e.getAttribute("emailtracker-detector")||(e.setAttribute("emailtracker-detector","1"),Detector_whitelist_image(e,emailtracker_detector_config.whitelist_url_string))})))})}heartbeat_port.onDisconnect.addListener(function(){setTimeout(function(){try{chrome.storage.local.get("heartbeat",function(){})}catch(e){Disconnected()}},100)}),window.emailtracker_untracked_emails=[],~window.location.host.indexOf("mail.live.com")?(Script_inject(chrome.runtime.getURL("lib/global_content.js")),Tracker(function(e){e(document.querySelector('span[title*="@"]').title)},function(r,o){function t(e){Tracker_insert(r,document.getElementById("ComposeRteEditor_surface").contentWindow.document.body,e,function(t,a){document.getElementById("CancelMessage").addEventListener("click",function(){a=1},!0),document.addEventListener("keydown",function(e){27===e.keyCode&&(a=1)},!0);var i=document.getElementsByName("fSubject").length?document.getElementsByName("fSubject")[0].value:"",n=[],e=(document.querySelectorAll(".To .cp_Contact").forEach(function(e){var e=e.textContent.replace(/"/g,"").replace(/;/g,"").trim(),t=e.split(" ",2);"<"+t[0]+">"===t[1]&&(e=t[0]),n.push(e)}),setInterval(function(){null===document.getElementById("ComposeRteEditor_surface").offsetParent&&(clearInterval(e),a||Xtion_request("https://mail.live.com/?fid=flsent",function(e){e=(new DOMParser).parseFromString(e,"text/html").querySelector(".mailList").firstElementChild.id;Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(t,{id_source:"0_"+e})}),Tracker_feed_info_insert(t,r,o,"0_"+e,i||"(no subject)",window.location.href.split("?")[0].split("#")[0]+"?tid="+encodeURIComponent("cm"+e.substring(2)),n)}))},100))})}function e(e){Tracker_send(function(){~window.location.href.indexOf("Compose")&&(e.ctrlKey||e.metaKey)&&13===e.keyCode&&(e.stopPropagation(),t(document.getElementById("SendMessage")))})}window.emailtracker_keydown||(window.emailtracker_keydown=1,window.addEventListener("keydown",e,!0));var a=top.document.getElementById("ComposeRteEditor_surface"),i=(a&&!a.getAttribute("data-emailtracker")&&(a.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(a),a.contentWindow.addEventListener("keydown",e,!0)),(a=document.getElementById("SendMessage"))&&!a.getAttribute("data-emailtracker")&&(a.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(a),a.addEventListener("click",function(e){Tracker_send(function(){a.getAttribute("data-emailtracker_loaded")||(e.stopPropagation(),e.preventDefault(),t(a))},a)})),[]),n=(document.querySelectorAll(".c-MessageRow").forEach(function(e){e.getAttribute("data-emailtracker")||(e.setAttribute("data-emailtracker","1"),i.push("0_"+e.id))}),i.length&&Request_background(LOCATION_ACTION+"emails?client=outlook_mail",function(e){JSON.parse(e).forEach(function(e){document.querySelector(".mailListPane.Narrow")?document.getElementById(e.id_source.replace("0_","")).querySelector("[id*=instantActionsControl]").parentNode.innerHTML+=Tracker_icon(e,{tag:"div",style:"display:inline-block;"}):document.getElementById(e.id_source.replace("0_","")).lastElementChild.previousElementSibling.lastElementChild.insertAdjacentHTML("afterBegin",Tracker_icon(e,{tag:"div",style:"display:inline-block;"}))})},{post:{emails:i}}),document.getElementById("ComposeRteEditor_surface"));n&&Css_rule(window.LOCATION_TRACKERS_V.map(function(e){return'img[src*="'+e+"?u="+r+'"]'}).join(",")+"{display:none;}",0,n.contentWindow.document)}),document.documentElement.classList.add("emailtracker_outlook")):~window.location.host.indexOf("mail.google.com")?(Script_inject(chrome.runtime.getURL("lib/global_content.js")),Script_inject(chrome.runtime.getURL("lib/gmail.js")),parse_response=function(e){var t=[];return e.split("\n").forEach(function(e){if(e=e.trim())try{t.push(new Function('"use strict"; return '+e.trim())())}catch(e){}}),t},Tracker(function(t){Variable("GLOBALS",function(e){e?t(e[10]):Variable(["gbar","_CONFIG",0,10],function(e){e&&t(e[5])})})},function(f,g){Variable("GM_SPT_ENABLED",function(e){e="true"===e,Variable("GM_RFT_ENABLED",function(s){var c,d,a;s="true"===s,window.emailtracker_uid=f,window.emailtracker_email=g,Storage_get("cache_email_"+f+"_aliases",function(e){window.emailtracker_uids=[f].concat(Object.values(e)),DEBUG&&Variable_set("emailtracker_uids",[f].concat(Object.values(e)))}),window.emailtracker_listening_sent||(window.emailtracker_listening_sent=1,document.addEventListener("emailtracker_send",function(t){if(!DISCONNECTED){function s(e){window.emailtracker_sending=1,setTimeout(function(){window.emailtracker_sending=0},2500),Variable_set(t.detail.sid,e)}var a=t.detail.object[1]&&t.detail.object[1].indexOf&&0===t.detail.object[1].indexOf("msg")?1:0,e=t.detail.object[a];if(ENABLED&&!~emailtracker_untracked_emails.indexOf("#"+e)){var i,n,d=[];if(DEBUG&&(console.log("Email Tracker Send",t.detail),window.emailtracker_send_detail=t.detail),t.detail.object){var l=t.detail.object,u={id:1,from:[2,2],to:3,cc:4,bcc:5,subject:8,body:[9,2,0,2],message_previous:[9,2,1],message_previous_body:[9,1,1,1],html_enabled:[9,7]};0==a&&(Xtion_foreach(u,function(e,a){u[a]instanceof Array?u[a].forEach(function(e,t){u[a][t]=0<u[a][t]?u[a][t]-1:u[a][t]}):u[a]=0<u[a]?u[a]-1:u[a]}),u.message_previous=[8,1,1],u.message_previous_body=[8,1,1,1]);try{var r=document.createDocumentFragment(),m=document.createElement("div"),_=(r.appendChild(m),m.innerHTML=Xtion_object_indexes(l,u.body),Xtion_object_indexes(l,u.message_previous)&&(i=document.createDocumentFragment(),n=document.createElement("div"),i.appendChild(n),n.innerHTML=Xtion_object_indexes(l,u.message_previous_body),Tracker_remove_previous(i),0==a?l[8][1][1][1]=i.firstChild.innerHTML:l[9][2][1][2]=i.firstChild.innerHTML),d=[].concat(l[u.to]||[],l[u.cc]||[],l[u.bcc]||[]).map(function(e){return 0==a?e[2]?e[2]+" <"+e[1]+">":e[1]:e[3]?e[3]+" <"+e[2]+">":e[2]}).filter(function(e,t,a){return a.indexOf(e)===t}),l[u.subject])}catch(e){Error_report(155,"Extraction Error: "+e,JSON.stringify(l))}function o(e){0!=Xtion_object_indexes(l,u.html_enabled)?Tracker_insert(f,m,document.createElement("button"),function(o,c){Storage_get("cache_email_"+emailtracker_uid+"_aliases",function(e){0==a?l[8][1][0][1]=m.innerHTML:l[9][2][0][2]=m.innerHTML;var n=[],r=(window.LOCATION_TRACKERS_V.forEach(function(t){[emailtracker_uid].concat(e?Object.values(e):[]).forEach(function(e){n.push(t+"?u="+encodeURIComponent(e)+"&amp;e="+encodeURIComponent(o.id))})}),function(t){if(Xtion_instr(Xtion_object_indexes(l,u.body),n)&&(document.removeEventListener("emailtracker_sent",r),!c)){DEBUG&&(console.log("Email Tracker Send Response",t.detail.response),Storage_get("debug_log_send_responses",function(e){(e=e||[]).push(t.detail.response),Storage_update("debug_log_send_responses",e)}));var e,a=0;try{var i=JSON.parse(t.detail.response);try{a=(Object_search(i,"^pfg",1,{limit:9999999,last:1,also:function(e){return e[u.id]&&e[u.id].indexOf&&~e[u.id].indexOf("msg")}})||Object_search(i,"^scheduled",1,{limit:9999999,last:1,also:function(e){return e[u.id]&&e[u.id].indexOf&&~e[u.id].indexOf("msg")}}))[u.id]||0}catch(e){DEBUG&&console.error("ET Response Object Search Error",e);try{if(!(a=i[2][6].reduce(function(e,t){t=Object_property(t,[1,3,7,1]),t=t&&t[5]?t[5].reverse().find(function(e){return e[11].includes("^pfg")||e[11].includes("^scheduled")}):null;return t?t[1]:e},null)))try{a=JSON.parse(t.detail.response)[2][6];try{a=~a[a.length-1][1][3][7][1][5][0][1].indexOf("msg")?a[a.length-1][1][3][7][1][5]:a}catch(e){a=a[a.length-1][1][3][7][1][5]}a=a[a.length-1][1]}catch(e){a=a[a.length-1][1][3][5][3][0]}}catch(e){Error_popup(153,"Extraction Error: "+e,t.detail.response)}}}catch(e){Error_popup(156,"Extraction Parse Error: "+e,t.detail.response)}a&&a.indexOf&&~a.indexOf("msg")?((e=document.querySelector('[data-message-id="#'+a+'"'))&&e.getAttribute("data-emailtracker")&&e.removeAttribute("data-emailtracker"),window.emailtracker_sent_id_last=a,window.emailtracker_sending=0,setTimeout(function(){window.emailtracker_sent_id_last=null},2500),Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(o,{id_source:"1_"+a})}),Tracker_feed_info_insert(o,f,g,"1_"+a,_||"(no subject)","",d),Storage_get("gmail_sent",function(e){(e=e||{})[a]=a,Storage_update("gmail_sent",e)}),Storage_get("cache_tracked_"+f,function(e){(e=e||{})[a]=1,Storage_update("cache_tracked_"+f,e),Storage_get("cache_untracked_"+f,function(e){(e=e||{})[a]&&delete e[a],Storage_update("cache_untracked_"+f,e)})}),document.documentElement.style.cursor="",(i=Object_search(JSON.parse(t.detail.response),"thread-",0,{value_contains:1}))&&i[1]&&(gmail_thread_last_message[i[1]]=a)):(window.emailtracker_sending=0,window[~t.detail.response.indexOf("Your action was unsuccessful")||~t.detail.response.indexOf("Error 502 (Server Error)")||~t.detail.response.indexOf("var gmail_server_error")?"Error_report":"Error_popup"](154,"The email was not sent correctly or if no error shows then Gmail broke the extension please contact us for a fix",t.detail.response))}});document.addEventListener("emailtracker_sent",r);try{s(l)}catch(e){Error_popup(152,"Unknown Edge Case: "+e,p.innerHTML)}})},null,{popup_loading_disable:1,uid_alias:e||!1}):(s(-1),Xtion_popup_temporary('Sent Email Untracked - HTML Emails must be Enabled. To disable this warning turn on HTML emails or click "Untracked" button instead of "Send". Click here to learn how to disable plain text mode.',{container_click:function(){window.open(LOCATION_MAIN+"help/gmail-disable-plain-text-mode")}}))}DEBUG?(e=Xtion_object_indexes(l,u.from))?e!=window.emailtracker_email?Tracker_email_alias_id(window.emailtracker_uid,e,o):o():(Error_report(840,"Alias from email undetected",l),o()):o()}else{var r=document.createDocumentFragment(),p=document.createElement("div");r.appendChild(p),p.innerHTML=t.detail.post.body,t.detail.post.uet&&(i=document.createDocumentFragment(),n=document.createElement("div"),i.appendChild(n),n.innerHTML=t.detail.post.uet,Tracker_remove_previous(i),Variable_set(t.detail.sid+"_quoted",i.firstChild.innerHTML)),d=(d=t.detail.post.to)&&d.filter(function(e){return e}),"0"!==t.detail.post.ishtml?Tracker_insert(f,p,document.createElement("button"),function(a,i){function n(e){var t;Xtion_instr(e.detail.post.body,window.LOCATION_TRACKERS_V.map(function(e){return e+"?u="+encodeURIComponent(f)+"&amp;e="+encodeURIComponent(a.id)}))&&(document.removeEventListener("emailtracker_sent",n),i||(t=0,parse_response(e.detail.response).forEach(function(e){e instanceof Array&&e.forEach(function(e){"a"===e[0]&&e[3]instanceof Array&&e[3][0]&&(t=e[3][0])})}),t?(Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(a,{id_source:"1_"+t})}),Tracker_feed_info_insert(a,f,g,"1_"+t,e.detail.post.subject||"(no subject)","",d),Storage_get("gmail_sent",function(e){(e=e||{})[t]=t,Storage_update("gmail_sent",e)}),Storage_get("cache_tracked_"+f,function(e){(e=e||{})[t]=1,Storage_update("cache_tracked_"+f,e),Storage_get("cache_untracked_"+f,function(e){(e=e||{})[t]&&delete e[t],Storage_update("cache_untracked_"+f,e)})}),document.documentElement.style.cursor=""):window[~e.detail.response.indexOf("Your action was unsuccessful")||~e.detail.response.indexOf("Error 502 (Server Error)")?"Error_report":"Error_popup"](151,"The email was not sent correctly or if no error shows then Gmail broke the extension please contact us for a fix",e.detail.response)))}document.addEventListener("emailtracker_sent",n);try{s(p.innerHTML)}catch(e){Error_popup(152,"Unknown Edge Case: "+e,p.innerHTML)}},null,{popup_loading_disable:1}):(s(-1),Xtion_popup_temporary('Sent Email Untracked - HTML Emails must be Enabled. To disable this warning turn on HTML emails or click "Untracked" button instead of "Send". Click here to learn how to disable plain text mode.',{container_click:function(){window.open(LOCATION_MAIN+"help/gmail-disable-plain-text-mode")}}))}}else s(-1)}})),document.querySelectorAll('[role="dialog"] [aria-label*="Enter"],.aoO[role=button],.Uo').forEach(function(i){var n;i.getAttribute("data-emailtracker")||i.querySelector("img.aPa")||(i.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(i),(n=i.parentNode.parentNode).parentNode.getAttribute("data-emailtracker"))||(n.parentNode.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(n.parentNode),Storage_get("settings",function(e){var t,a;(e=e||{}).button_send_disable_tracking_hide||(t=n.parentNode.querySelector(".emailtracker_untracked"),a=Uniqid("emailtracker_untracked",!0),t&&t.parentNode.removeChild(t),n.insertAdjacentHTML("afterEnd",'<td class="gU emailtracker_untracked" style="width:0;padding:0;margin:0;"></td><td class="gU emailtracker_untracked"><div class="emailtracker_untracked_inner"><div class="'+i.className.replace("aoO","").replace("Uo","")+'" role="button" tabindex="1" data-tooltip="Send without Email Tracker" data-tooltip-delay="800" style="-webkit-user-select: none; position: relative;font-size:10px;" id="'+a+'">Send Untracked</div></div></td>'),setTimeout(function(){document.getElementById(a).onclick=function(){var t=this;Storage_get("warning_untracked",function(e){if(e){window.ENABLED=0;try{window.emailtracker_untracked_emails.push(Xtion_parents(n,"td>form",{contains:1}).querySelector("input[type=hidden][name=draft]").getAttribute("value"))}catch(e){}i.click(),setTimeout(function(){window.ENABLED=1},1e3)}else Storage_update("warning_untracked","1",function(){confirm("Are you sure you want to send this email untracked? This warning will not show up again.")&&t.onclick()})})}},50)),e.button_send_disable_tracking_links&&User_is_pro(function(e){var t;e&&(e=n.parentNode.querySelector(".emailtracker_unlinktracked"),t=Uniqid("emailtracker_unlinktracked",!0),e&&e.parentNode.removeChild(e),n.insertAdjacentHTML("afterEnd",'<td class="gU emailtracker_unlinktracked" style="padding-right:1px;"><div class="emailtracker_untracked_inner"><div class="'+i.className.replace("aoO","").replace("Uo","")+'" role="button" tabindex="1" data-tooltip="Send without Link Tracking" data-tooltip-delay="800" style="-webkit-user-select:none;position:relative;margin-right:0;font-size:10px;" id="'+t+'">Unlink Tracked</div></div></td>'),setTimeout(function(){document.getElementById(t).onclick=function(){var t=this;Storage_get("warning_unlinktracked",function(e){e?Storage_get("tracking_links_disabled",function(e){e?i.click():Storage_update("tracking_links_disabled",1,function(){i.click(),setTimeout(function(){Storage_update("tracking_links_disabled",0)},1e3)})}):Storage_update("warning_unlinktracked","1",function(){confirm("Are you sure you want to send this email without link tracking? This warning will not show up again.")&&t.onclick()})})}},50))},!0)}))}),e&&document.querySelector("[data-message-id]")&&!window.emailtracker_sending&&(c=[],document.querySelectorAll("[data-message-id]").forEach(function(e){e.getAttribute("data-emailtracker")||(e.setAttribute("data-emailtracker","1"),void 0!==window.emailtracker_messages_tracking[e.getAttribute("data-message-id").replace("#","")]&&0===window.emailtracker_messages_tracking[e.getAttribute("data-message-id").replace("#","")])||c.push({id:"1_"+e.getAttribute("data-message-id").replace("#",""),id_legacy:e.getAttribute("data-legacy-message-id")?"1_"+e.getAttribute("data-legacy-message-id"):null})}),c.length)&&Storage_get("cache_opened_"+f,function(o){o=o||{},Storage_get("cache_untracked_"+f,function(t){t=t||{};function a(e){DISCONNECTED||e.forEach(function(i){try{try{Array.prototype.slice.call(document.querySelector('[data-message-id="#'+i.id_source.replace("1_","")+'"],[data-legacy-message-id="'+i.id_source.replace("1_","")+'"]').querySelectorAll("[role=checkbox]")).forEach(function(e){if(!e.getAttribute("data-emailtracker")&&(e.setAttribute("data-emailtracker","1"),!(e=e.parentNode).getElementsByClassName("emailtracker_status").length)){e.insertAdjacentHTML("afterBegin",Tracker_icon(i,{style:"position:relative;top:-"+(s?"2":"6")+"px;padding:0 6px;"})),0;var t,a=0;try{Xtion_parents(e,'[role="listitem"]').querySelectorAll("span[email]").forEach(function(e){if(e.getAttribute("email").toLowerCase()!==g.toLowerCase())throw a=0,{};a++})}catch(e){}2!=a&&3!=a||(e=Xtion_parents(e,"[role=listitem]").querySelector(window.LOCATION_TRACKERS_V.map(function(e){return'img[src*="'+e+"?u="+f+'"]'}).join(",")))&&(t=e.src.split("#"),e.src=(t[1]||t[0]).replace("?u=","?self&u=")),1==i.status&&(o[i.id_source]=1)}})}catch(e){console.error(e)}}catch(i){}})}var i=[],n=[],r=[];c.forEach(function(e){window.emailtracker_sent_id_last&&window.emailtracker_sent_id_last===e.id.replace("1_","")?(window.emailtracker_sent_id_last=null,r.push({id_source:e.id,status:0})):o[e.id]||o[e.id_legacy]?i.push({id_source:o[e.id]?e.id:e.id_legacy,status:1}):t[e.id]||t[e.id_legacy]||(n.push(e.id),e.id_legacy&&n.push(e.id_legacy))});n.length?Request_background(LOCATION_ACTION+"user_emails?client=gmail_messages",function(e){a(JSON.parse(e).concat(i).concat(r)),Storage_update("cache_opened_"+f,o)},{post:{id_user:f,emails:n}}):a(i.concat(r))})}),!window.InboxSDK&&!document.querySelector("[data-thread-id]")||document.querySelector('[data-thread-id*="msg"]')&&0!==location.hash.indexOf("#sent")&&0!==location.hash.indexOf("#search")&&0!==location.hash.indexOf("#advanced-search")||(d=[],a=[],document.querySelectorAll("[data-inboxsdk-threadid],[data-thread-id]").forEach(function(e){var t=(e.getAttribute("data-inboxsdk-threadid")||e.getAttribute("data-thread-id")).replace("#","");e.getAttribute("data-emailtracker")||(e&&gmail_thread_last_message[t]&&(e.setAttribute("data-emailtracker","1"),e.setAttribute("data-emailtracker-message",gmail_thread_last_message[t]),a.push(e),d.push(t)),e&&(gmail_thread_last_message_legacy[t]||gmail_thread_last_message_legacy[e.getAttribute("data-legacy-last-non-draft-message-id")||e.getAttribute("data-legacy-last-message-id")])&&(e.setAttribute("data-emailtracker","1"),e.setAttribute("data-emailtracker-message-legacy",gmail_thread_last_message_legacy[t]||gmail_thread_last_message_legacy[e.getAttribute("data-legacy-last-non-draft-message-id")||e.getAttribute("data-legacy-last-message-id")])))}),a.length&&Storage_get("cache_opened_"+f,function(c){c=c||{},Storage_get("cache_untracked_"+f,function(o){o=o||{},Storage_get("gmail_sent",function(a){a=a||{};function t(e){var i=[];e.forEach(function(t){document.querySelectorAll('[data-emailtracker-message="'+t.id_source.replace("1_","")+'"],[data-emailtracker-message-legacy="'+t.id_source.replace("1_","")+'"]').forEach(function(e){e.getAttribute("data-thread-id")&&(e=Xtion_parents(e,"tr")),i.push(t.id_source),e&&!e.classList.contains("emailtracker")&&(e.classList.add("emailtracker"),s?e.innerHTML+='<td class="xY" style="padding-right:8px;order:1"> '+Tracker_icon(t,{style:"position:relative;"})+"</td>":(e=e.children)[e.length-2].innerHTML+=" "+Tracker_icon(t,{style:"position:relative;top:-2px;margin-left:2px;"}),1==t.status)&&(c[t.id_source]=1)})}),Storage_get("cache_tracked_"+f,function(a){a=a||{},n.forEach(function(e,t){~i.indexOf(e)||a[e]||(o[e]=1)})})}var n=[],i=[],r=[];d.forEach(function(e){var t="1_"+(a[e]||gmail_thread_last_message[e]),t=(n.push(t),c[t]?i.push({id_source:t,status:1}):o[t]||r.push(t),gmail_thread_last_message_legacy[e]);t&&(n.push(t="1_"+t),c[t]?i.push({id_source:t,status:1}):o[t]||r.push(t))});r.length?Request_background(LOCATION_ACTION+"user_emails?client=gmail_threads",function(e){t(JSON.parse(e).concat(i)),Storage_update("cache_opened_"+f,c),Storage_update("cache_untracked_"+f,o)},{post:{id_user:f,emails:r}}):t(i)})})}))})})},{interval:500}),window.gmail_thread_last_message||(window.gmail_thread_last_message=localStorage.emailtracker_cache_threads_last_message?JSON.parse(localStorage.emailtracker_cache_threads_last_message):{}),window.gmail_thread_last_message_legacy||(window.gmail_thread_last_message_legacy=localStorage.emailtracker_cache_threads_last_message_legacy?JSON.parse(localStorage.emailtracker_cache_threads_last_message_legacy):{}),window.gmail_messages=[],window.addEventListener("beforeunload",function(){localStorage.emailtracker_cache_threads_last_message="",localStorage.emailtracker_cache_threads_last_message_legacy=""}),document.addEventListener("emailtracker_threads",function(e){var a,t,i;window.DISCONNECTED||(DEBUG&&console.log("emailtracker_threads",e.detail),a=[],"xhr_threads"===e.detail.type?(t=JSON.parse(e.detail.data),(i=Xtion_object_indexes(t,3,0,1,4))&&i.indexOf&&0===i.indexOf("thread")?t[3].forEach(function(e){a.push(e[1])}):(i=Xtion_object_indexes(t,2,0,0,3))&&i.indexOf&&0===i.indexOf("thread")&&t[2].forEach(function(e){a.push(e[0])})):"xhr_threads_new"===e.detail.type?(t=JSON.parse(e.detail.data),(i=Xtion_object_indexes(t,2,6,0,1,3,7,1,4))&&i.indexOf&&0===i.indexOf("thread")&&t[2][6].forEach(function(e){var t=Xtion_object_indexes(e,1,3,7,1);t&&e&&e[1]&&e[1][1]&&e[1][1].indexOf&&0===e[1][1].indexOf("thread")&&a.push(t)})):"embedded_a6jdv"===e.detail.type?e.detail.data.forEach(function(e){e&&e[2]&&(e=Xtion_object_indexes(JSON.parse(e[2]),1,1))&&e.forEach(function(e){a.push(e[5])})}):"embedded_Cl6csf"===e.detail.type&&e.detail.data.forEach(function(e){e&&e[2]&&(e=Xtion_object_indexes(JSON.parse(e[2]),2))&&e.forEach(function(e){a.push(e[2])})}),a.length&&(DEBUG&&console.debug("emailtracker_threads_found",a),Storage_get("gmail_sent",function(n){n=n||{},a.forEach(function(e){var t={thread_id:4,thread_messages:5,message_id:1,thread_messages_labels:11,legacy_message_id:48,legacy_message_id2:56},a=(e[3]&&e.indexOf&&0===e[3].indexOf("thread")&&(t={thread_id:3,thread_messages:4,message_id:0,thread_messages_labels:10,legacy_message_id:47,legacy_message_id2:55}),e[t.thread_id]),i=!1;e&&e[t.thread_messages]instanceof Array&&e[t.thread_messages].reverse().forEach(function(e){!i&&e&&e[t.thread_messages_labels]instanceof Array&&~e[t.thread_messages_labels].indexOf("^f")&&(i=e)}),i[t.legacy_message_id]?gmail_thread_last_message_legacy[a]=decToHex(i[t.legacy_message_id]):i[t.legacy_message_id2]&&(gmail_thread_last_message_legacy[a]=i[t.legacy_message_id2]),gmail_thread_last_message[a]=n[a]||i[t.message_id]}),localStorage.emailtracker_cache_threads_last_message_legacy=JSON.stringify(gmail_thread_last_message_legacy),localStorage.emailtracker_cache_threads_last_message=JSON.stringify(gmail_thread_last_message)})))}),document.addEventListener("emailtracker_info",function(i){window.DISCONNECTED||(window.DEBUG&&console.log("emailtracker_info",i),window.DEBUG&&i.detail.aliases&&Interval_retry(function(){return window.emailtracker_uid},function(){var e,t,a=[];i.detail.aliases.forEach(function(e){e=e[1];Email_valid(e)&&a.push(e)}),a.length&&(e=0,(t=function(){Tracker_email_alias_id(window.emailtracker_uid,a[e],function(){a[++e]&&t()})})())}))}),document.addEventListener("emailtracker_threads_old",function(e){var a;window.DISCONNECTED||(a=[],parse_response(e.detail.data).forEach(function(e){e&&e[0]&&"tb"===e[0][0]?e[0][2].forEach(function(e){a.push(e)}):e instanceof Array&&e.forEach(function(e){e instanceof Array&&"tb"===e[0]?e[2].forEach(function(e){a.push(e)}):e instanceof Array&&e.forEach(function(e){e instanceof Array&&"cs"===e[0]&&a.push([e[1],e[2]])})})}),a.length&&Storage_get("gmail_sent",function(t){t=t||{},a.forEach(function(e){gmail_thread_last_message[e[0]]=t[e[0]]||e[1]}),localStorage.emailtracker_cache_threads_last_message=JSON.stringify(gmail_thread_last_message)}))}),window.emailtracker_messages_tracking=[],document.addEventListener("emailtracker_messages",function(a){!window.DISCONNECTED&&window.emailtracker_uid&&Storage_get("cache_email_"+emailtracker_uid+"_aliases",function(t){var e=JSON.parse(a.detail.data);e&&e[2]instanceof Array&&0===e[2][0][1].indexOf("thread")&&e[2].forEach(function(e){e[3]instanceof Array&&e[3].forEach(function(a){var i,n;0===a[1].indexOf("msg")&&a[2]&&a[2][6]&&a[2][6][2]&&(i=Xtion_object_indexes(a,2,6,2,3,3,2),n=0,[window.emailtracker_uid].concat(t?Object.values(t):[]).forEach(function(t){n||window.LOCATION_TRACKERS_V.forEach(function(e){e=e+"?u="+t+"&";(~a[2][6][2][0][3][2].indexOf(e)||i&&~i.indexOf(e))&&(n=1)})}),window.emailtracker_messages_tracking[a[1]]=n)})})})}),document.documentElement.classList.add("emailtracker_gmail"),Detector_initialize("gmail")):~window.location.host.indexOf("inbox.google.com")?(Script_inject(chrome.runtime.getURL("lib/global_content.js")),google_inbox_url=function(){return location.protocol+"//"+location.hostname+(0===location.pathname.indexOf("/u/")?"/u/"+location.pathname.split("/")[2]+"/":"/")},Tracker(function(t){Variable(["gbar","_CONFIG",0,10],function(e){e&&t(e[5])})},function(uid,email){var f=function(el){Tracker_insert(uid,el.parentNode.parentNode.parentNode.parentNode.querySelector('[role=textbox],.editable[jsaction*=compose],[g_editable="true"]'),el,function(tracking,cancel){try{el.parentNode.parentNode.querySelector("button[jsaction*=close]").addEventListener("click",function(){cancel=1},!0)}catch(e){}el.parentNode.parentNode.addEventListener("keydown",function(e){27===e.keyCode&&(cancel=1)},!0);var subject=el.parentNode.parentNode.parentNode.querySelector(".iO>input"),subject=subject?subject.value:document.querySelector(".eo").textContent,to=[],sending=(el.parentNode.parentNode.parentNode.querySelectorAll("div[email]").forEach(function(e){var t=e.getAttribute("aria-label"),e=e.getAttribute("email");to.push(t+(t!==e?" <"+e+">":""))}),setInterval(function(){var retries,retries_max,f;null===el.offsetParent&&(clearInterval(sending),cancel||(retries=0,retries_max=5,f=function(){setTimeout(function(){Xtion_request(google_inbox_url()+"sent",function(r){try{eval("window.embeddedAppData="+Xtion_string_between(r,"preloadedData=",";window.BT"));for(var data=window.embeddedAppData,i=0;i<data.length;i++){var m=data[i];if(m&&m.indexOf&&~m.indexOf("items")){try{var messages=JSON.parse(m)}catch(err){if(retries<retries_max)return retries++,void setTimeout(f,1e3);Error_popup(204,err,r)}if(messages.tables&&messages.tables.items&&!messages.tables.items.length){if(retries<retries_max)return retries++,void setTimeout(f,1e3);Error_popup(203,"Inbox Configuration not yet supported please contact us for compatibility")}var messages=messages.tables?messages.tables.items:messages[1][1],last=0,em="",id="";if(messages.forEach(function(e){var e=e.c||e.d||e,t=e[1]&&e[1][4]?e[1][4]:e[5][3],a=1===e[2].length?e[1][1]:e[2].pop?e[2].pop()[1]:e[2];e&&last<t&&(last=t,em=e,id=a.split(":").pop())}),id){Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(tracking,{id_source:"4_"+id})}),Tracker_feed_info_insert(tracking,uid,email,"4_"+id,subject||"(no subject)","",to),document.documentElement.style.cursor="";break}Error_popup(200,"Inbox Changed Their Structure. Please contact us for a fix.",r)}}}catch(e){Error_popup(201,e,r)}})},500)},f()))},100))},null,{remove_previous_blank_src:1})},ids=(document.querySelectorAll('[jsaction*="send"]').forEach(function(t){t.getAttribute("data-emailtracker")||"global.cancel_send"===t.getAttribute("jsaction")||(t.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(t),t.style.position="relative",t.innerHTML+='<div style="position:absolute;top:-1px;left:-1px;width:105%;height:105%;"></div>',t.lastChild.addEventListener("click",function(e){Tracker_send(function(){e.stopPropagation(),e.preventDefault(),f(t)},t)},!0),t.parentNode.parentNode.addEventListener("keydown",function(e){Tracker_send(function(){(e.ctrlKey||e.metaKey)&&13===e.keyCode&&(e.stopPropagation(),f(t))})},!0))}),[]),t;document.querySelectorAll("[data-item-id],[data-msg-id]").forEach(function(e){e.firstChild.classList.contains("emailtracker")||(e.firstChild.classList.add("emailtracker"),e=(e.getAttribute("data-item-id")||e.getAttribute("data-msg-id")).split(":").pop(),ids.push(0===e.indexOf("r")?"4_"+e:"1_"+decToHex(e)))}),ids.length&&Request_background(LOCATION_ACTION+"emails?client=inbox",function(e){JSON.parse(e).forEach(function(t){var e=t.id_source.split("_").pop(),a=(0===t.id_source.indexOf("1_")&&(e=hexToDec(e)),document.querySelector('[data-item-id*="'+e+'"],[data-msg-id*="'+e+'"]'));a.style.willChange="no",setInterval(function(){if(!a.querySelector(".emailtracker_status"))try{var e;!a.classList.contains("scroll-list-item")||a.classList.contains("scroll-list-item-open")?(e=(e=a.querySelectorAll(a.querySelector("[data-msg-id]")?"[data-msg-id]:first-child .action":".action"))[e.length-1].parentNode.firstChild).insertAdjacentHTML("afterBegin",Tracker_icon(t)+" "):((e=a.querySelector("[email]").parentNode.parentNode).style.position="relative",e.innerHTML+=Tracker_icon(t,{style:"position:absolute;right:0;"}))}catch(e){}},1e3)})},{post:{emails:ids}}),window.thread_load||(window.thread_load=1,t=Xtion_uri_query_parameters(location.search),t&&t.th&&setTimeout(function(){document.querySelector('[data-item-id*="'+t.th+'"] [jsaction]').click()},1e3))})):~window.location.host.indexOf("outlook.live.com")||~window.location.host.indexOf("outlook.office365.com")||~window.location.host.indexOf("outlook.office.com")||0===location.pathname.indexOf("/owa/")?(0===location.pathname.indexOf("/owa/")?(window.EMAIL_OUTLOOK=1,Script_inject(chrome.runtime.getURL("lib/global_content.js")),Script_inject(chrome.runtime.getURL("lib/outlook.js")),Tracker(function(t){Variable(["owaSDState","data"],function(e){e&&t(Xtion_string_between(e,'LogonEmailAddress":"','",'))})},function(d,l){var u;window.emailtracker_listening_sent||(window.emailtracker_listening_sent=1,u=(new Date).getTime()-15e3,document.addEventListener("emailtracker_send",function(t){var e,a,c,s,i,n,r;DISCONNECTED||(e=function(e){Variable_set(t.detail.sid,e)},ENABLED?(n=t.detail.post.Body,(a=n.Items?n.Items[0].Body:n.ItemChanges[0].Updates)instanceof Array&&a.forEach(function(e){e.Item&&e.Item.Body&&(a=e.Item.Body)}),(c=n.Items?n.Items[0].Subject:n.ItemChanges[0].Updates)instanceof Array&&c.forEach(function(e){e.Item&&void 0!==e.Item.Subject&&(c=e.Item.Subject)}),s=[],(i=n.Items?n.Items[0].ToRecipients:n.ItemChanges[0].Updates)instanceof Array&&i.forEach(function(e){e.Item&&e.Item.ToRecipients&&(i=e.Item.ToRecipients)}),i.forEach(function(e){s.push(e.Name+(e.Name!==e.EmailAddress?" <"+e.EmailAddress+">":""))}),n=document.createDocumentFragment(),r=document.createElement("div"),n.appendChild(r),r.innerHTML=a.Value,"HTML"===a.BodyType?Tracker_insert(d,r,document.createElement("button"),function(o,a){function i(e){var t;e.detail.post&&e.detail.post.Body&&(e=e.detail.post.Body,(t=e.Items?e.Items[0].Body:e.ItemChanges[0].Updates)instanceof Array&&t.forEach(function(e){e.Item&&e.Item.Body&&(t=e.Item.Body)}),Xtion_instr(t.Value,window.LOCATION_TRACKERS_V.map(function(e){return e+"?u="+encodeURIComponent(d)+"&amp;e="+encodeURIComponent(o.id)})))&&(document.removeEventListener("emailtracker_sent",i),a||setTimeout(function(){Background_cookie("X-OWA-CANARY",function(e){var i=0,n=15,r=function(){Xtion_request("https://"+window.location.host+"/owa/service.svc",function(t){var e,a;try{(a=JSON.parse(t).Body.ResponseMessages.Items[0].RootFolder.Items[0]||null)&&new Date(a.DateTimeSent).getTime()>=u&&c==a.Subject?(e=a.ItemId.Id,Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(o,{id_source:"2_"+e})}),Tracker_feed_info_insert(o,d,l,"2_"+e,c||"(no subject)","https://"+window.location.host+"/owa/?viewmodel=ReadMessageItem&ispopout=1&ItemID="+encodeURIComponent(e),s)):i<n?(i++,setTimeout(r,1e3)):Error_popup(322,"Outlook1 tracking computer time incorrect incompatibility. Please contact us for a fix",JSON.stringify([t].concat(a?[new Date(a.DateTimeSent).getTime(),u,c,a.Subject]:[])))}catch(e){Error_popup(320,"Outlook1 changes broke Email Tracker. Please contact us for a fix: "+e,t)}},{post:{},headers:{Action:"FindItem","X-OWA-CANARY":e,"X-OWA-UrlPostData":encodeURIComponent('{"__type":"FindItemJsonRequest:#Exchange","Header":{"__type":"JsonRequestHeaders:#Exchange","RequestServerVersion":"Exchange2013","TimeZoneContext":{"__type":"TimeZoneContext:#Exchange","TimeZoneDefinition":{"__type":"TimeZoneDefinitionType:#Exchange","Id":"Pacific Standard Time"}}},"Body":{"__type":"FindItemRequest:#Exchange","ItemShape":{"__type":"ItemResponseShape:#Exchange","BaseShape":"IdOnly"},"ParentFolderIds":[{"__type":"DistinguishedFolderId:#Exchange","Id":"sentitems"}],"Traversal":"Shallow","Paging":{"__type":"IndexedPageView:#Exchange","BasePoint":"Beginning","Offset":0,"MaxEntriesReturned":5},"ViewFilter":"All","IsWarmUpSearch":false,"ShapeName":"MailListItem","SortOrder":[{"__type":"SortResults:#Exchange","Order":"Descending","Path":{"__type":"PropertyUri:#Exchange","FieldURI":"DateTimeSent"}}]}}')}})};r()},{url:"https://"+window.location.host})},1e3))}document.addEventListener("emailtracker_sent",i),e(r.innerHTML)},null,{popup_loading_disable:0}):(e(-1),Xtion_popup_temporary('Sent Email Untracked - HTML Emails must be Enabled. To disable this warning turn on HTML emails or click "Untracked" button instead of "Send"'))):e(-1))})),window.error_report_custom.language||Background_cookie("mkt",function(e){window.error_report_custom.language=e},{url:"https://"+window.location.host}),~window.location.href.indexOf("mail/sentitems")&&window.cache_sent_indexes&&setTimeout(function(){document.querySelectorAll("[role=listbox] [role=option]");for(var e in window.cache_sent_indexes)Icon_insert(e,window.cache_sent_indexes[e],Uniqid("",!0).replace(".","_"))},300)}),window.emailtracker_id_loading=[],window.Icon_insert=function(e,t,a){function i(e){document.querySelector('[data-emailtracker-id="'+t.id_source+'"]')||(e.insertAdjacentHTML("afterBegin",Tracker_icon(t,{attributes:'data-emailtracker-id="'+t.id_source+'" data-emailtracker-'+a+'="'+t.id_source+'"'})+" "),~window.cache_id_detection.indexOf(a))||(window.cache_id_detection.forEach(function(e){~window.location.href.indexOf("mail/sentitems")&&document.querySelector("[data-emailtracker-"+e+"]")||window.cache_id_deletion.push(window.cache_id_detection.splice(window.cache_id_detection.indexOf(e),1))}),window.cache_id_detection.push(a))}var n,r=Array.prototype.slice.call(document.querySelectorAll("[role=listbox] [role=option]")).filter(function(e){return e.offsetParent});window.cache_sent_indexes_conversation?document.querySelector(".allowTextSelection[role=document]>.conductorContent")?(n=r[e])&&i((n=n.lastElementChild.previousElementSibling.previousElementSibling.getElementsByTagName("span"))[n.length-1]):(n=r[e])&&i((n=n.querySelector("span[class*=Subject],span[role=note]").parentNode.parentNode.previousElementSibling.getElementsByTagName("span"))[n.length-1]):(n=document.querySelectorAll(".searchFolder")[e])?i(n.nextElementSibling):(n=r[e])&&i((n=n.lastElementChild.previousElementSibling.previousElementSibling.getElementsByTagName("span"))[n.length-1])},document.addEventListener("emailtracker_items",function(t){var a,i,n,r,o;~window.location.href.indexOf("mail/sentitems")&&(window.cache_sent_indexes={},(t=(a=(t=JSON.parse(t.detail.body).Body).Conversations)?{IndexedPagingOffset:t.IndexedOffset,Items:t.Conversations}:t.ResponseMessages.Items[0].RootFolder).Items)&&t.Items.length&&(i=t.IndexedPagingOffset-t.Items.length,n=Uniqid("",!0).replace(".","_"),window.cache_sent_indexes_conversation=a,r=[],o=[],t.Items.forEach(function(e){r.push(a?"2_"+e.ItemIds[e.ItemIds.length-1].Id:"2_"+e.ItemId.Id),o.push("2_"+e.ConversationId.Id)}),r.length)&&!~window.emailtracker_id_loading.indexOf(t.IndexedPagingOffset)&&Request_background(LOCATION_ACTION+"emails?client=outlook_live",function(e){window.emailtracker_id_loading.push(t.IndexedPagingOffset),setTimeout(function(){JSON.parse(e).forEach(function(e){var t=i+(~r.indexOf(e.id_source)?r:o).indexOf(e.id_source);window.cache_sent_indexes[t]=e,Icon_insert(t,e,n)}),window.emailtracker_id_loading.splice(window.emailtracker_id_loading.indexOf(t.IndexedPagingOffset),1)},800)},{post:{emails:r.concat(o)}})}),window.cache_id_detection=[],window.cache_id_deletion=[],setInterval(function(){DISCONNECTED||(window.cache_id_detection.forEach(function(e){~window.location.href.indexOf("mail/sentitems")&&document.querySelector("[data-emailtracker-"+e+"]")||window.cache_id_deletion.push(window.cache_id_detection.splice(window.cache_id_detection.indexOf(e),1))}),window.cache_id_deletion.forEach(function(e){document.querySelectorAll("[data-emailtracker-"+e+"]").forEach(function(e){e.parentNode.removeChild(e)})}))},200)):0===location.pathname.indexOf("/mail/")&&(window.EMAIL_OUTLOOK=1,Script_inject(chrome.runtime.getURL("lib/global_content.js")),Script_inject(chrome.runtime.getURL("lib/outlook2.js")),inbox_index=Xtion_string_between(location.pathname,"/mail/","/"),isNaN(inbox_index)&&!~inbox_index.indexOf("@")&&(inbox_index=""),~location.search.indexOf("emailtracker_id")&&(0===location.pathname.indexOf("/mail/"+inbox_index+"/deeplink")?setTimeout(function(){document.querySelector('[role="main"]')||(location.href="https://"+window.location.host+"/mail/"+inbox_index+"/sentitems?emailtracker_id="+encodeURIComponent(new URLSearchParams(window.location.search).get("emailtracker_id")))},5e3):0!==location.pathname.indexOf("/mail/"+inbox_index+"/sentitems")&&!location.pathname.indexOf("/mail/sentitems")||Interval_retry(function(){return document.querySelector("#searchBoxId-Mail input,#owaSearchBox_container input")},function(e){e.focus(),setTimeout(function(){React_input_set_value(e,"&e="+new URLSearchParams(window.location.search).get("emailtracker_id")+"&v="),setTimeout(function(){document.querySelector('#searchBoxId-Mail + button,[role="search"]>button').click()},500)},500)})),window.emailtracker_ini=0,window.emailtracker_listening_sent=0,Tracker(function(e){try{var t=sessionStorage.sessionTracking_ActiveAccountIdentifier;(email=(email=t?Object_property(JSON.parse(localStorage[t]),["upn"]):email)||Object_property(JSON.parse(localStorage["olk-BootDiagnostics"]),["upn"]))&&e(email)}catch(e){console.error(e)}},function(e,u){window.emailtracker_uid=e,window.emailtracker_email=u,window.emailtracker_listening_sent||(window.emailtracker_listening_sent=1,document.addEventListener("emailtracker_send",function(t){var i,e,s,a,d,l,n,r,o;DISCONNECTED||(i="emailtracker_sent"+t.detail.sid,e=function(e){Variable_set(t.detail.sid,e)},ENABLED?(DEBUG&&(console.log("Email Tracker Send",t.detail),window.emailtracker_send_detail=t.detail),r=t.detail.post.Body,s=moment().unix()-60,(a=r.Items?r.Items[0].NewBodyContent||r.Items[0].Body:r.ItemChanges[0].Updates)instanceof Array&&a.forEach(function(e){e.Item&&e.Item.Body&&(a=e.Item.Body)}),(d=r.Items?r.Items[0].Subject:r.ItemChanges[0].Updates)instanceof Array&&d.forEach(function(e){e.Item&&void 0!==e.Item.Subject&&(d=e.Item.Subject)}),l=[],(n=r.Items?r.Items[0].ToRecipients:r.ItemChanges[0].Updates)instanceof Array&&n.forEach(function(e){e.Item&&e.Item.ToRecipients&&(n=e.Item.ToRecipients)}),n.forEach(function(e){l.push(e.Name+(e.Name!==e.EmailAddress?" <"+e.EmailAddress+">":""))}),r=document.createDocumentFragment(),o=document.createElement("div"),r.appendChild(o),o.innerHTML=a.Value,"HTML"===a.BodyType?(~location.pathname.indexOf("/deeplink/compose/")&&Global_content_action("window_close_disable"),Tracker_insert(window.emailtracker_uid,o,document.createElement("button"),function(c,t){function a(e){document.removeEventListener(i,a),t||setTimeout(function(){e&&e.detail&&e.detail.headers&&e.detail.headers.has("date")&&(s=moment(e.detail.headers.get("date")).unix()-60);var n=0,r=15,o=function(){Xtion_request("https://"+window.location.host+"/owa/"+inbox_index+"/service.svc?action=FindItem&EP=1&app=Mail",function(t){var a=null;try{var e,a=null,i=JSON.parse(t).Body.ResponseMessages.Items;i[0]&&i.forEach(function(e){e.RootFolder.Items[0]&&e.RootFolder.Items.forEach(function(t){t.ExtendedProperty&&t.ExtendedProperty[0]&&(t.IsDraft?t.ExtendedProperty.forEach(function(e){!e.ExtendedFieldURI||"0x3FEF"!==e.ExtendedFieldURI.PropertyTag&&"0x3fef"!==e.ExtendedFieldURI.PropertyTag||"SystemTime"!==e.ExtendedFieldURI.PropertyType||t.ExtendedProperty.forEach(function(e){e.ExtendedFieldURI&&"emailtracker_id"===e.ExtendedFieldURI.PropertyName&&e.Value.split("_")[0]===c.id&&(a=t)})}):t.ExtendedProperty.forEach(function(e){e.ExtendedFieldURI&&"emailtracker_id"===e.ExtendedFieldURI.PropertyName&&e.Value.split("_")[0]===c.id&&(a=t)}))})}),a?(e=a.ItemId.Id,Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(c,{id_source:"2_"+e})}),Tracker_feed_info_insert(c,window.emailtracker_uid,window.emailtracker_email,"2_"+e,d||"(no subject)","https://"+window.location.host+"/mail/"+inbox_index+"deeplink/read/"+encodeURIComponent(e)+"?emailtracker_eid="+c.id,l)):n<r?(n++,setTimeout(o,2e3)):Error_popup(a?323:324,a?"Outlook2 mismatch subject error":"Outlook2 fetch error",JSON.stringify([t].concat(a?[moment(a.DateTimeSent).unix(),s,d,a.Subject]:[c,s])))}catch(e){Error_popup(321,"Outlook2 changes broke Email Tracker. Please contact us for a fix: "+e,t)}},{post:{},headers:Xtion_object_merge({Action:"FindItem","content-type":"application/json; charset=utf-8","X-OWA-CANARY":Cookie_get("X-OWA-CANARY"),"X-OWA-UrlPostData":encodeURIComponent(JSON.stringify({__type:"FindItemJsonRequest:#Exchange",Header:{__type:"JsonRequestHeaders:#Exchange",RequestServerVersion:"V2018_01_08",TimeZoneContext:{__type:"TimeZoneContext:#Exchange",TimeZoneDefinition:{__type:"TimeZoneDefinitionType:#Exchange",Id:"Pacific Standard Time"}}},Body:{__type:"FindItemRequest:#Exchange",ParentFolderIds:[{__type:"DistinguishedFolderId:#Exchange",Id:"sentitems"},{__type:"DistinguishedFolderId:#Exchange",Id:"drafts"}],ItemShape:{__type:"ItemResponseShape:#Exchange",BaseShape:"IdOnly",AdditionalProperties:[{__type:"ExtendedPropertyUri:#Exchange",PropertySetId:"0f593b63-959d-4095-910c-c7dfe59ce739",PropertyName:"emailtracker_id",PropertyType:"String"},{__type:"ExtendedPropertyUri:#Exchange",PropertyTag:"0x3FEF",PropertyType:"SystemTime"}]},ShapeName:"MailListItem",Traversal:"Shallow",Paging:{__type:"IndexedPageView:#Exchange",BasePoint:"Beginning",Offset:0,MaxEntriesReturned:5},FocusedViewFilter:-1,ViewFilter:"All",SortOrder:[{__type:"SortResults:#Exchange",Order:"Descending",Path:{__type:"PropertyUri:#Exchange",FieldURI:"DateTimeReceived"}}]}}))},window.emailtracker_authorization_last?{Authorization:window.emailtracker_authorization_last,"X-AnchorMailbox":u}:{})})};o()},1e3)}document.addEventListener(i,a),e({body:o.innerHTML,id_tracking:c.id,id_tracking_v:c.idv})},null,{popup_loading_disable:0})):(e(-1),Xtion_popup_temporary("Sent Email Untracked - HTML Emails must be Enabled. To disable this warning turn on HTML emails or temporarily disable Email Tracker"))):e(-1))})),(~window.location.href.indexOf("/sentitems")||document.querySelector('[id="groupHeaderTop results"]'))&&window.cache_sent_indexes&&setTimeout(function(){document.querySelectorAll("[role=listbox] [role=option]");for(var e in window.cache_sent_indexes)Icon_insert(window.cache_sent_indexes[e],Uniqid("",!0).replace(".","_"))},300)}),document.addEventListener("emailtracker_authorization",function(e){e.detail.body&&(window.emailtracker_authorization_last=e.detail.body)}),window.emailtracker_id_loading=[],window.ids_to_element_query={},window.cache_sent_indexes={},window.Icon_insert=function(e,t){var a=document.querySelector(window.ids_to_element_query[e.id_source]);a&&(a=a.querySelector('span[title*=":"],span[title*="-"],span[title*="/"]'),a=a,document.querySelector('[data-emailtracker-id="'+e.id_source+'"]')||(a.insertAdjacentHTML("afterBegin",Tracker_icon(e,{attributes:'data-emailtracker-id="'+e.id_source+'" data-emailtracker-'+t+'="'+e.id_source+'"'})+" "),~window.cache_id_detection.indexOf(t))||(window.cache_id_detection.forEach(function(e){(~window.location.href.indexOf("sentitems")||document.querySelector('[id="groupHeaderTop results"]'))&&document.querySelector("[data-emailtracker-"+e+"]")||window.cache_id_deletion.push(window.cache_id_detection.splice(window.cache_id_detection.indexOf(e),1))}),window.cache_id_detection.push(t)))},is_on_search=function(){return document.querySelector('[id="groupHeaderTop results"]')&&document.getElementById("searchScopeButtonId-option").innerText.includes("Sent")},document.addEventListener("emailtracker_items",function(t){if(!DISCONNECTED&&(~window.location.href.indexOf("/sentitems")||is_on_search())){DEBUG&&console.log("emailtracker_items",t,JSON.parse(t.detail.body));var a,i,n=t.detail.hasOwnProperty("search_index");if(n){var e=t.detail.search_index;if(t=JSON.parse(t.detail.body),a="Conversation"===t.EntitySets[0].EntityType,!(t={IndexedPagingOffset:e,Items:t.EntitySets[0].ResultSets[0].Results}).Items||!t.Items.length)return;t.Items=t.Items.map(function(e){return e.Source}),i=e+t.Items.length,DEBUG&&console.log("emailtracker_items_search",t)}else{if(t=JSON.parse(t.detail.body).Body,a=t.Conversations,!(t=a?{IndexedPagingOffset:t.IndexedOffset,Items:t.Conversations}:t.ResponseMessages.Items[0].RootFolder).Items||!t.Items.length)return;i=t.IndexedPagingOffset-t.Items.length}var r,o,c=Uniqid("",!0).replace(".","_"),s=(window.cache_sent_indexes_conversation=a,[]),d=[],l=[],u=[];t.Items.forEach(function(e){var t;n?(window.ids_to_element_query["2_"+e.ItemIds[0].Id]='[data-convid="'+e.ConversationId.Id+'"]',s.push("2_"+e.ItemIds[0].Id)):a?(window.ids_to_element_query["2_"+e.ItemIds[0].Id]='[id="'+e.InstanceKey+'"]',s.push("2_"+e.ItemIds[0].Id)):(window.ids_to_element_query["2_"+e.ItemId.Id]='[id="'+e.InstanceKey+'"]',s.push("2_"+e.ItemId.Id),t="",e.ExtendedProperty&&e.ExtendedProperty instanceof Array&&e.ExtendedProperty.forEach(function(e){e.ExtendedFieldURI&&"emailtracker_idv"===e.ExtendedFieldURI.PropertyName&&~e.Value.indexOf("_")&&(t=e.Value.split("_")[0],u.push(e.Value))}),l.push(t)),d.push("2_"+e.ConversationId.Id)}),s.length&&!~window.emailtracker_id_loading.indexOf(t.IndexedPagingOffset)&&(DEBUG&&console.log("emailtracker_items ids",s),r=function(){Request_background(LOCATION_ACTION+"emails2?client=outlook_live",function(e){window.emailtracker_id_loading.push(t.IndexedPagingOffset),setTimeout(function(){JSON.parse(e).forEach(function(e){var t=i+(e.id&&~l.indexOf(e.id)?l.indexOf(e.id):(~s.indexOf(e.id_source)?s:d).indexOf(e.id_source));window.cache_sent_indexes[t]=e,Icon_insert(e,c)}),window.emailtracker_id_loading.splice(window.emailtracker_id_loading.indexOf(t.IndexedPagingOffset),1)},800)},{post:{emails:s.concat(d),email_ids:u}})},a&&(o=[],s.forEach(function(e){void 0===window.cache_conversation_item_emailtracker_ids[e]?(l.push(""),o.push({__type:"ItemId:#Exchange",Id:e.replace("2_","")})):window.cache_conversation_item_emailtracker_ids[e]?(l.push(window.cache_conversation_item_emailtracker_ids[e].split("_")[0]),u.push(window.cache_conversation_item_emailtracker_ids[e])):l.push("")}),o.length)?Xtion_request("https://"+window.location.host+"/owa/"+inbox_index+"/service.svc?action=GetItem&app=Mail",function(t){try{var e=JSON.parse(t).Body.ResponseMessages.Items;e[0]&&(DEBUG&&console.log("conversation_items",e),e.forEach(function(t){var a;t&&t.Items&&t.Items[0]&&(t=t.Items[0],a="",t.ExtendedProperty&&t.ExtendedProperty instanceof Array&&t.ExtendedProperty.forEach(function(e){e.ExtendedFieldURI&&"emailtracker_idv"===e.ExtendedFieldURI.PropertyName&&~e.Value.indexOf("_")&&(l[s.indexOf("2_"+t.ItemId.Id)]=e.Value.split("_")[0],a=e.Value,u.push(e.Value))}),window.cache_conversation_item_emailtracker_ids["2_"+t.ItemId.Id]=a)}),Storage_update("outlook2_cache_conversation_item_emailtracker_ids",JSON.stringify(window.cache_conversation_item_emailtracker_ids)),r())}catch(e){Error_report(327,"Outlook2 item fetch error Email Tracker. Please contact us for a fix: "+e,t)}},{post:JSON.stringify({__type:"GetItemJsonRequest:#Exchange",Header:{__type:"JsonRequestHeaders:#Exchange",RequestServerVersion:"V2018_01_08",TimeZoneContext:{__type:"TimeZoneContext:#Exchange",TimeZoneDefinition:{__type:"TimeZoneDefinitionType:#Exchange",Id:"Pacific Standard Time"}}},Body:{__type:"GetItemRequest:#Exchange",ItemShape:{__type:"ItemResponseShape:#Exchange",BaseShape:"IdOnly",AdditionalProperties:[{__type:"ExtendedPropertyUri:#Exchange",PropertySetId:"6edab709-7fed-4c7a-a77e-33831fd504cf",PropertyName:"emailtracker_idv",PropertyType:"String"}]},ItemIds:o,ShapeName:null}}),headers:Xtion_object_merge({Action:"GetItem","X-OWA-CANARY":Cookie_get("X-OWA-CANARY"),"content-type":"application/json"},window.emailtracker_authorization_last?{Authorization:window.emailtracker_authorization_last,"X-AnchorMailbox":email}:{})}):r())}}),window.cache_id_detection=[],window.cache_id_deletion=[],window.cache_conversation_item_emailtracker_ids={},Storage_get("outlook2_cache_conversation_item_emailtracker_ids",function(e){e&&(window.cache_conversation_item_emailtracker_ids=JSON.parse(e))}),setInterval(function(){DISCONNECTED||(window.cache_id_detection.forEach(function(e){(~window.location.href.indexOf("/sentitems")||document.querySelector('[id="groupHeaderTop results"]'))&&document.querySelector("[data-emailtracker-"+e+"]")||window.cache_id_deletion.push(window.cache_id_detection.splice(window.cache_id_detection.indexOf(e),1))}),window.cache_id_deletion.forEach(function(e){document.querySelectorAll("[data-emailtracker-"+e+"]").forEach(function(e){e.parentNode.removeChild(e)})}))},200)),document.documentElement.classList.add("emailtracker_outlook2"),setInterval(function(){document.querySelectorAll('[data-app-section="MessageList"],[aria-label="Message list"]').forEach(function(e){e.classList[700<e.offsetWidth?"add":"remove"]("emailtracker_messagelistfullwidth")})},1e3),Detector_initialize("outlook")):~window.location.href.indexOf("mail.yahoo.com/neo")||~window.location.host.indexOf("mail.yahoo.com")&&~window.location.href.indexOf("src=neo")||~window.location.href.indexOf("mail.yahoo.com")&&document.querySelector("html#Stencil")?(Script_inject(chrome.runtime.getURL("lib/global_content.js")),Script_inject(chrome.runtime.getURL("lib/yahoo.js")),Tracker(function(t){Variable(["NeoConfig","V3MailboxEmail"],function(e){t(e)})},function(s,d){function a(c){Variable(["NeoConfig","V3MailboxId"],function(o){Variable(["NeoConfig","wssid"],function(r){Tracker_insert(s,c.parentNode.parentNode.parentNode.parentNode.querySelector("#rtetext"),c,function(t,a){try{c.parentNode.parentNode.parentNode.parentNode.querySelector(".icon-close").addEventListener("click",function(){a=1},!0),document.addEventListener("keydown",function(e){27===e.keyCode&&(a=1)},!0)}catch(e){}var i=(i=c.parentNode.parentNode.parentNode.parentNode.querySelector("#subject-field"))?i.value:"",n=[],e=(c.parentNode.parentNode.parentNode.parentNode.querySelectorAll("#to [data-address]").forEach(function(e){var t=e.textContent,e=e.getAttribute("data-address");n.push(t+(t!==e?" <"+e+">":""))}),setInterval(function(){(!c||c.getBoundingClientRect().left<1)&&(clearInterval(e),a||setTimeout(function(){Xtion_request("https://"+window.location.host+"/ws/v3/batch?name=mailbox.sync&appId=YMailNorrin&wssid="+encodeURIComponent(r),function(e){e=JSON.parse(e).result.responses[0].response.result.messages[0].id;Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(t,{id_source:"3_"+e})}),Tracker_feed_info_insert(t,s,d,"3_"+e,i||"(no subject)",location.protocol+"//"+location.host+"/neo/b/message?mid="+encodeURIComponent(e),n)},{post:{batchJson:JSON.stringify({requests:[{id:"GetMessageGroupList",uri:"/ws/v3/mailboxes/@.id=="+o+"/messages/@.select==q?q="+encodeURIComponent("folderId:2 -folderType:(SYNC)-folderType:(INVISIBLE) count:1 offset:0 -sort:date"),method:"GET",payloadType:"embedded"}],responseType:"json"})},headers:{accept:"application/json","x-specify-origin":window.location.origin}})},1500))},100))})})})}var t;window.emailtracker_keydown||(window.emailtracker_keydown=1,window.addEventListener("keydown",function(e){Tracker_send(function(){var t=0;document.querySelectorAll('span[data-action="send"]').forEach(function(e){0<e.getBoundingClientRect().left&&(t=e)}),t&&(e.ctrlKey||e.metaKey)&&13===e.keyCode&&(e.stopPropagation(),a(t))})},!0)),document.querySelectorAll('span[data-action="send"]').forEach(function(t){t.getAttribute("data-emailtracker")||(t.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(t),t.addEventListener("click",function(e){Tracker_send(function(){t.getAttribute("data-emailtracker_loaded")||(e.stopPropagation(),e.preventDefault(),a(t))},t)}))}),document.querySelector(".btn-sent[aria-selected=true]")&&(t=[],document.querySelectorAll("[data-mid]").forEach(function(e){e.getAttribute("data-emailtracker")||(e.setAttribute("data-emailtracker","1"),e.getAttribute("data-mid")&&(t.push(e.getAttribute("data-mid")),t.push(e.getAttribute("data-mid").replace("-","+"))))}),t.length)&&Request_background(LOCATION_ACTION+"emails_threads_yahoo",function(e){JSON.parse(e).forEach(function(e){var t=(document.querySelector('[data-mid="'+e.id_source.split("_").pop()+'"]')||document.querySelector('[data-mid="'+e.id_source.split("_").pop().replace("+","-")+'"]')).querySelector(".thread-date");t.getAttribute("data-emailtracker")||(t.setAttribute("data-emailtracker","1"),t.innerHTML='<span title="'+t.title+'">'+t.innerHTML+"</span>",t.title="",t.insertAdjacentHTML("afterBegin",Tracker_icon(e)))})},{post:{emails:t}}),window.emailtracker_yahoo_initialized||(window.emailtracker_yahoo_initialized=1,Variable(["NeoConfig","wssid"],function(c){Variable(["NeoConfig","V3MailboxId"],function(e){document.addEventListener("emailtracker_items",function(e){e=JSON.parse(e.detail.body).result;function t(){setTimeout(function(){document.querySelector(".list-view-items").scrollTop+=1,setTimeout(function(){var e,a=[];o.forEach(function(e,t){a.push("3_"+o[t].mid)}),a.length&&((e=document.querySelectorAll(".cbox[role=gridcell]>input[role=checkbox]")).forEach(function(e,t){t<a.length&&(e.setAttribute("role","checkbox."),e.setAttribute("data-emailtracker",a[t]))}),e.length)&&Request_background(LOCATION_ACTION+"emails?client=yahoo",function(e){JSON.parse(e).forEach(function(e){var t=Xtion_parents(document.querySelector('[data-emailtracker="'+e.id_source+'"]'),3).querySelector(".date");t.getAttribute("data-emailtracker")||t.getAttribute("data-emailtracker-compatibility")||(t.setAttribute("data-emailtracker","1"),t.innerHTML='<span title="'+t.title+'">'+t.innerHTML+"</span>",t.title="",t.insertAdjacentHTML("afterBegin",Tracker_icon(e)))})},{post:{emails:a}})},300)},500)}var n,r,o=[];e.conversations?(n=[],r=[],Storage_get("cache_yahoo_conversations",function(i){var a;i=i||{},e.conversations.forEach(function(e,t){if(e=e.conversation,n.push(e.cid),1<e.summary.totalMsgs)i[e.cid]&&i[e.cid].total===e.summary.totalMsgs?o[t]={mid:i[e.cid].last}:r.push(e.cid);else{e.messageInfo.reverse();try{e.messageInfo.forEach(function(e){if("Sent"===e.sourceFolderInfo.fid)throw o[t]=e,{}})}catch(e){}}}),r.length?(a="",r.forEach(function(e,t){a+='{"id":"LMT_'+t+'","method":"POST","payloadType":"embedded","uri":"/ws/mail/v2.0/jsonrpc","payload":{"method":"ListMessagesInThread","params":[{"fid":"Sent","cid":"'+e+'"}]}},'}),a=a.slice(0,-1),Xtion_request("https://"+window.location.host+"/ws/v3/batch?appid=YahooMailNeo&wssid="+encodeURIComponent(c),function(e){e.split(e.split("\n")[0].trim()).forEach(function(e){e=e.split("\n{");if(e[1]&&(e=JSON.parse("{"+e[1])).result){var t=e.result.conversation.cid,a=e.result.conversation.summary.totalMsgs;(e=e.result.messageInfo).reverse();try{e.forEach(function(e){if("Sent"===e.sourceFolderInfo.fid)throw o[n.indexOf(t)]=e,i[t]={total:a,last:e.mid},{}})}catch(e){}}}),Storage_update("cache_yahoo_conversations",i),t()},{post:'{"requests":['+a+"]}",headers:{"content-type":"application/json"}})):t()})):(o=e.messageInfo,t())}),document.addEventListener("emailtracker_items2",function(t){t=JSON.parse(t.detail.body).result.responses[0].response.result;function a(i){setTimeout(function(){document.querySelector(".list-view-items").scrollTop+=1,setTimeout(function(){var e,a=[];n.forEach(function(e,t){a.push(i?"3_"+n[t].uidl:"3_"+n[t].mid)}),a.length&&((e=document.querySelectorAll(".cbox[role=gridcell]>input[role=checkbox]")).forEach(function(e,t){t<a.length&&(e.setAttribute("role","checkbox."),e.setAttribute("data-emailtracker",a[t]))}),e.length)&&Request_background(LOCATION_ACTION+"emails",function(e){JSON.parse(e).forEach(function(e){var t=Xtion_parents(document.querySelector('[data-emailtracker="'+e.id_source),3).querySelector(".date");t.getAttribute("data-emailtracker")||t.getAttribute("data-emailtracker-compatibility")||(t.setAttribute("data-emailtracker","1"),t.innerHTML='<span title="'+t.title+'">'+t.innerHTML+"</span>",t.title="",t.insertAdjacentHTML("afterBegin",Tracker_icon(e)))})},{post:{emails:a}})},300)},500)}var n=[];t.conversations?Storage_get("cache_yahoo_conversations",function(e){t.conversations.forEach(function(a,i){t.messages.forEach(function(e){var t=e.headers.date;e.conversationId===a.id&&2==e.folder.id&&(!n[i]||t>n[i].date)&&(n[i]={date:t,uidl:e.id})})}),a(1)}):(n=t.messages,a(1))})})}))}),document.documentElement.classList.add("emailtracker_yahoo")):~window.location.host.indexOf("mail.yahoo.com")&&(Script_inject(chrome.runtime.getURL("lib/global_content.js")),Script_inject(chrome.runtime.getURL("lib/yahoo2.js")),window.emailtracker_yahoo_sent_conversations_last_message_id={},state_load=function(){Variable_returned(["AppState","reduxState","action","messageGroupList"],"AppState",function(e){2==e.reduxState.action.folderId&&e.reduxState.action.messageGroupList.forEach(function(e){window.emailtracker_yahoo_sent_conversations_last_message_id[e.id]=e.messages[0].id})})},"complete"===document.readyState?state_load():document.addEventListener("DOMContentLoaded",state_load),document.addEventListener("emailtracker_items",function(e){var t=JSON.parse(e.detail.body).result.responses[1].response.result.conversations;DEBUG&&console.log("emailtracker_items",JSON.parse(e.detail.body)),t&&t.length&&t.forEach(function(e){~e.folderIds.indexOf("2")&&(window.emailtracker_yahoo_sent_conversations_last_message_id[e.id]=e.messageIds.pop())})}),location.search.includes("emailtracker_conversation_id")&&setTimeout(function(){var e;location.pathname.includes("/messages/")||(e=new URLSearchParams(location.search).get("emailtracker_conversation_id"))&&(location.href="https://mail.yahoo.com/n/folders/2/messages/"+e)},1500),Tracker(function(t){Variable(["AppState","reduxState","mailboxes","accounts",1,"email"],function(e){t(e)})},function(d,l){Variable(["AppState","reduxState","mailboxes","id"],function(s){Variable(["AppBootstrapData","mailboxAttributes","web.enableConversations","value"],function(a){function i(o){var c=Xtion_parents(o,4);Variable(["AppBootstrapData","mailWssid"],function(r){Tracker_insert(d,c.querySelector('[data-test-id="rte"]'),o,function(a,e){var i,n,t;c.querySelector('[data-test-id="richtext-on"]')?Xtion_popup_temporary("Sent Email Untracked - Rich text mode must be enabled to enable tracking. To disable this warning turn on rich text mode or disable email tracker. Click here to learn how to enable rich text mode",{container_click:function(){window.open(LOCATION_MAIN+"help/yahoo-enable-rich-text-mode")}}):(i=(i=Xtion_parents(o,4).querySelector('[data-test-id="compose-subject"]')||Xtion_parents(o,5).querySelector('[id="compose-subject-input"]'))?i.value:"",n=[],Xtion_parents(o,4).querySelectorAll('[data-test-id="compose-header-top"] [title*="@"]').forEach(function(e){n.push(e.getAttribute("title"))}),n.length||Xtion_parents(o,5).querySelectorAll('.compose-header [title*="@"]').forEach(function(e){n.push(e.getAttribute("title"))}),DEBUG&&console.log("Email Tracker Send Info:",i,n),t=setInterval(function(){(!o||o.getBoundingClientRect().left<1)&&(clearInterval(t),e||setTimeout(function(){Xtion_request("https://"+window.location.host+"/ws/v3/batch?name=folderChange.getList&appId=YMailNorrin&wssid="+encodeURIComponent(r),function(e){DEBUG&&console.log("Email Tracker Sent Get Email",e,JSON.parse(e));var e=JSON.parse(e).result.responses[0].response.result.messages[0],t=e.id;Request_background(LOCATION_ACTION+"email_sent",null,{post:Xtion_object_merge(a,{id_source:"3_"+t})}),Tracker_feed_info_insert(a,d,l,"3_"+t,i||"(no subject)",0===location.pathname.indexOf("/d/")?"https://"+location.host+"/d/folders/2/messages/"+encodeURIComponent(t):"https://"+location.host+"/n/folders/2/messages/"+encodeURIComponent(t)+"?emailtracker_conversation_id="+e.conversationId,n)},{post:{batchJson:JSON.stringify({requests:[{id:"GetMessageGroupList",uri:"/ws/v3/mailboxes/@.id=="+s+"/messages/@.select==q?q="+encodeURIComponent("folderId:2 -folderType:(SYNC)-folderType:(INVISIBLE) count:1 offset:0 -sort:date"),method:"GET",payloadType:"embedded"}],responseType:"json"})},headers:{accept:"application/json","x-specify-origin":window.location.origin}})},1500))},100))})})}window.emailtracker_keydown||(window.emailtracker_keydown=1,window.addEventListener("keydown",function(e){Tracker_send(function(){var t=0;document.querySelectorAll('[data-test-id="compose-send-button"]').forEach(function(e){0<e.getBoundingClientRect().left&&(t=e)}),t&&(e.ctrlKey||e.metaKey)&&13===e.keyCode&&(e.stopPropagation(),i(t))})},!0)),document.querySelectorAll('[data-test-id="compose-send-button"]').forEach(function(t){t.getAttribute("data-emailtracker")||(t.setAttribute("data-emailtracker","1"),window.emailtracker_elements.push(t),t.addEventListener("click",function(e){Tracker_send(function(){t.getAttribute("data-emailtracker_loaded")||(e.stopPropagation(),e.preventDefault(),i(t))},t)}))});var n=[],r=[];0===location.pathname.indexOf("/d/folders/2")?(document.querySelectorAll('a[data-test-id="message-list-item"]').forEach(function(e){var t;!e.getAttribute("data-emailtracker")&&e.getAttribute("href")&&(e.setAttribute("data-emailtracker","1"),~e.getAttribute("href").indexOf("?")?n.push("3_"+e.getAttribute("href").split("?")[0].split("/").pop()):~e.getAttribute("href").indexOf("/folders/2/messages/")&&(a?(t=e.getAttribute("href").split("folders/2/messages/")[1])&&window.emailtracker_yahoo_sent_conversations_last_message_id[t]&&(r["3_"+window.emailtracker_yahoo_sent_conversations_last_message_id[t]]=t,n.push("3_"+window.emailtracker_yahoo_sent_conversations_last_message_id[t])):n.push("3_"+e.getAttribute("href").split("folders/2/messages/")[1])))}),n.length&&Request_background(LOCATION_ACTION+"emails",function(e){JSON.parse(e).forEach(function(e){var t=document.querySelector('a[data-test-id="message-list-item"][href*="'+e.id_source.replace("3_","")+'"]'+(r[e.id_source]?',a[data-test-id="message-list-item"][href*="/folders/2/messages/'+r[e.id_source]+'"]':',a[data-test-id="message-list-item"][href*="/folders/2/messages/'+e.id_source.replace("3_","")+'"]')).querySelector('[data-test-id="message-subject"]');t.getAttribute("data-emailtracker")||(t.setAttribute("data-emailtracker","1"),t.insertAdjacentHTML("afterBegin",Tracker_icon(e)+" "))})},{post:{emails:n}})):0===location.pathname.indexOf("/n/folders/2")&&(document.querySelectorAll('[data-test-id="message-list-item"]').forEach(function(e){var t;!e.getAttribute("data-emailtracker")&&e.getAttribute("aria-labelledby").includes("email-subject-")&&(e.setAttribute("data-emailtracker","1"),t=0,e.getAttribute("aria-labelledby").split(" ").forEach(function(e){e.includes("email-subject-")&&(t=e.replace("email-subject-",""))}),a?t&&window.emailtracker_yahoo_sent_conversations_last_message_id[t]&&(n.push("3_"+window.emailtracker_yahoo_sent_conversations_last_message_id[t]),r["3_"+window.emailtracker_yahoo_sent_conversations_last_message_id[t]]=t):n.push("3_"+t))}),n.length)&&Request_background(LOCATION_ACTION+"emails",function(e){JSON.parse(e).forEach(function(e){var t=document.querySelector('[data-test-id="message-list-item"][aria-labelledby*="'+e.id_source.replace("3_","")+'"]'+(r[e.id_source]?',[data-test-id="message-list-item"][aria-labelledby*="email-subject-'+r[e.id_source]+' "]':"")).querySelector('[id*="email-subject-"]');t.getAttribute("data-emailtracker")||(t.setAttribute("data-emailtracker","1"),t.insertAdjacentHTML("afterbegin",Tracker_icon(e)+" "))})},{post:{emails:n}})})})}),document.documentElement.classList.add(location.href.includes("https://mail.yahoo.com/n/")?"emailtracker_yahoo3":"emailtracker_yahoo2"),Detector_initialize("yahoo")),xtion.loading='<img src="'+chrome.runtime.getURL("image/loading_white.gif")+'" alt="Loading.."/>',chrome.runtime.onMessage.addListener(function(t,e,a){Global_content_action("window_top",null,function(e){if(e)switch(t.a){case"activated":DISCONNECTED||a(ACTIVATED);break;case"emailtracker_toggle":break;case"detector_config_update":Detector_initialize()}})});
