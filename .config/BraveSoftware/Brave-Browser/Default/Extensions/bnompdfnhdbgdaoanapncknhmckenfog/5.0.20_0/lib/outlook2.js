!function(){Object.defineProperty(window,"Worker",{configurable:!0,value:void 0});function h(e,t){function n(e,t){return t<(e=parseInt(e,10).toString(16)).length?e.slice(e.length-t):t>e.length?Array(t-e.length+1).join("0")+e:e}return void 0===e&&(e=""),this.php_js||(this.php_js={}),this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(123456789*Math.random())),this.php_js.uniqidSeed++,e=e,e=(e+=n(parseInt((new Date).getTime()/1e3,10),8))+n(this.php_js.uniqidSeed,5),t&&(e+=(10*Math.random()).toFixed(8).toString()),e}window.emailtracker_detector=h();var l=window.emailtracker_detector,m=(window.emailtracker_authorization_token_ssjk939kjkkdjkjknhv0dd434E&&document.dispatchEvent(new CustomEvent("emailtracker_authorization_token",{detail:{body:window.emailtracker_authorization_token_ssjk939kjkkdjkjknhv0dd434E}})),fetch),e=(window.fetch=function(e,a){if(window.emailtracker_detector!==l)return m.apply(this,arguments);var t,n,r,i,d,o,s=arguments,p=e&&e.url?e.url:e;try{if(!p||!p.indexOf)return m.apply(this,arguments);if(!((~p.indexOf("action=CreateItem")||~p.indexOf("action=UpdateItem"))&&top.document.documentElement.getAttribute("data-emailtracker-initialized")&&a&&a.body))return~p.indexOf("action=FindItem")&&top.document.documentElement.getAttribute("data-emailtracker-initialized")&&a&&a.headers&&(t=a.headers.get("x-owa-urlpostdata"))&&(n=JSON.parse(decodeURIComponent(t)),r={__type:"ExtendedPropertyUri:#Exchange",PropertySetId:"6edab709-7fed-4c7a-a77e-33831fd504cf",PropertyName:"emailtracker_idv",PropertyType:"String"},i=~p.indexOf("action=FindConversation")?"ConversationShape":"ItemShape",n.Body)&&n.Body[i]&&(n.Body[i].AdditionalProperties?n.Body[i].AdditionalProperties.push(r):n.Body[i].AdditionalProperties=[r],a.headers.set("x-owa-urlpostdata",encodeURIComponent(JSON.stringify(n))),s[1]=a),(d=a&&a.headers?a.headers.get("authorization"):null)&&d.includes&&(d.includes("usertoken")||d.includes("Bearer"))&&(window.emailtracker_authorization_token_ssjk939kjkkdjkjknhv0dd434E=d,document.dispatchEvent(new CustomEvent("emailtracker_authorization",{detail:{body:d}}))),(o=m.apply(this,s)).then(function(t){var e=a?a.headers&&a.headers.get&&a.headers.get("x-owa-urlpostdata")||a.body:"";return(~t.url.indexOf("action=FindItem")||~t.url.indexOf("searchservice/api/v2/query")||~t.url.indexOf("action=FindConversation")&&~e.indexOf("ReactConversationSentItemsListView"))&&t.clone().text().then(function(e){document.dispatchEvent(new CustomEvent("emailtracker_items",{detail:function(e,t){if(e&&t){for(var n in t)t.hasOwnProperty(n)&&!e[n]&&(e[n]=t[n]);return e}return t||e||{}}({body:e},~t.url.indexOf("searchservice/api/v2/query")?{search_index:function(t,e){try{return e.forEach(function(e){t=t[e]}),t}catch(e){return null}}(JSON.parse(a.body),["EntityRequests",0,"From"])}:{})}))}),t}),o;try{var c,u,y=JSON.parse(a.body);return"SendAndSaveCopy"===y.Body.MessageDisposition?(c=this,u="emailtracker_send"+h(),top.document.dispatchEvent(new CustomEvent("emailtracker_send",{detail:{sid:u,post:y}})),new Promise(function(r,e){function t(){o++,n()?i():o<=d.retries?setTimeout(t,d.delay):d.callback_timeout&&d.callback_timeout()}var n,i,d,o;n=function(){return top[u]},i=function(){-1!==top[u]&&(t={__type:"ExtendedPropertyType:#Exchange",Value:top[u].id_tracking,ExtendedFieldURI:{__type:"ExtendedPropertyUri:#Exchange",PropertySetId:"0f593b63-959d-4095-910c-c7dfe59ce739",PropertyName:"emailtracker_id",PropertyType:"String"}},e={__type:"ExtendedPropertyType:#Exchange",Value:top[u].id_tracking+"_"+top[u].id_tracking_v,ExtendedFieldURI:{__type:"ExtendedPropertyUri:#Exchange",PropertySetId:"6edab709-7fed-4c7a-a77e-33831fd504cf",PropertyName:"emailtracker_idv",PropertyType:"String"}},y.Body.Items?(y.Body.Items[0].Body?y.Body.Items[0].Body.Value=top[u].body:y.Body.Items[0].NewBodyContent&&(y.Body.Items[0].NewBodyContent.Value=top[u].body),Array.isArray(y.Body.Items[0].ExtendedProperty)||(y.Body.Items[0].ExtendedProperty=[]),y.Body.Items[0].ExtendedProperty.push(t),y.Body.Items[0].ExtendedProperty.push(e)):((n=y.Body.ItemChanges[0].Updates).forEach(function(e,t){e.Item&&e.Item.Body&&(n[t].Item.Body.Value=top[u].body)}),n&&(n.push({__type:"SetItemField:#Exchange",Item:{__type:"Message:#Exchange",ExtendedProperty:[t]},Path:t.ExtendedFieldURI}),n.push({__type:"SetItemField:#Exchange",Item:{__type:"Message:#Exchange",ExtendedProperty:[e]},Path:e.ExtendedFieldURI}))),a.body=JSON.stringify(y));var e,n,t=m.apply(this,s);t.then(function(t){return t.clone().text().then(function(e){document.dispatchEvent(new CustomEvent("emailtracker_sent"+u,{detail:{response:e,headers:new Map(t.headers.entries())}}))}),t}),r(t)},(d=(d={retries:10,callback_timeout:function(){m.apply(c,s)}})||{}).delay=d.delay||500,d.retries=d.retries||30,o=0,t()})):m.apply(this,arguments)}catch(e){return console.error(e),m.apply(this,arguments)}}catch(e){return m.apply(this,arguments)}},XMLHttpRequest.prototype),n=e.open,t=e.send;e.open=function(e,t){return this._url=t,n.apply(this,arguments)},e.send=function(e){return window.emailtracker_detector===l&&this.addEventListener("load",function(){}),t.apply(this,arguments)}}();
