function Xtion_html_special_chars(e,t){if(null==e)return"";var n=3,o=(t=void 0!==t&&t,0),r=0,i=!1,a=(null==n&&(n=2),e=e.toString(),e=(e=!1!==t?e.replace(/&/g,"&amp;"):e).replace(/</g,"&lt;").replace(/>/g,"&gt;"),{ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4});if(0===n&&(i=!0),"number"!=typeof n){for(n=[].concat(n),r=0;r<n.length;r++)0===a[n[r]]?i=!0:a[n[r]]&&(o|=a[n[r]]);n=o}return n&a.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/'/g,"&#039;")),e=i?e:e.replace(/"/g,"&quot;")}function Xtion_html_entity_decode(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}window.xtion=window.xtion||{},window.xtion.detection=window.xtion.detection||{},"function"!=typeof Array.move&&(Array.prototype.move=function(e,t){this.splice(t,0,this.splice(e,1)[0])}),"remove"!=typeof Array.remove&&(Array.prototype.remove=function(){for(var e,t,n=arguments,o=n.length;o&&this.length;)for(e=n[--o];-1!==(t=this.indexOf(e));)this.splice(t,1);return this}),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){"use strict";if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var o=Object(o),r=Object.keys(o),i=0,a=r.length;i<a;i++){var c=r[i],s=Object.getOwnPropertyDescriptor(o,c);void 0!==s&&s.enumerable&&(t[c]=o[c])}}return t}}),"undefined"!=typeof HTMLCollection&&(HTMLCollection.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this[t],t)},NodeList.prototype.forEach=HTMLCollection.prototype.forEach,HTMLOptionsCollection.prototype.forEach=HTMLCollection.prototype.forEach),window.BreakException={};var Xtion_base64_key="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Xtion_utf8_encode(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):t=127<o&&o<2048?(t+=String.fromCharCode(o>>6|192))+String.fromCharCode(63&o|128):(t=(t+=String.fromCharCode(o>>12|224))+String.fromCharCode(o>>6&63|128))+String.fromCharCode(63&o|128)}return t}function Xtion_utf8_decode(e){var t,n="",o=0;for(c1=c2=0;o<e.length;)(t=e.charCodeAt(o))<128?(n+=String.fromCharCode(t),o++):191<t&&t<224?(c2=e.charCodeAt(o+1),n+=String.fromCharCode((31&t)<<6|63&c2),o+=2):(c2=e.charCodeAt(o+1),c3=e.charCodeAt(o+2),n+=String.fromCharCode((15&t)<<12|(63&c2)<<6|63&c3),o+=3);return n}function Xtion_base64_encode(e){var t,n,o,r,i,a,c="",s=0;for(e=Xtion_utf8_encode(e);s<e.length;)o=(t=e.charCodeAt(s++))>>2,r=(3&t)<<4|(t=e.charCodeAt(s++))>>4,i=(15&t)<<2|(n=e.charCodeAt(s++))>>6,a=63&n,isNaN(t)?i=a=64:isNaN(n)&&(a=64),c=c+Xtion_base64_key.charAt(o)+Xtion_base64_key.charAt(r)+Xtion_base64_key.charAt(i)+Xtion_base64_key.charAt(a);return c}function Xtion_base64_decode(e){var t,n,o,r,i,a,c="",s=0;for(e=e.replace(/[^A-Za-z0-9+\/=]/g,"");s<e.length;)o=Xtion_base64_key.indexOf(e.charAt(s++)),t=(15&(r=Xtion_base64_key.indexOf(e.charAt(s++))))<<4|(i=Xtion_base64_key.indexOf(e.charAt(s++)))>>2,n=(3&i)<<6|(a=Xtion_base64_key.indexOf(e.charAt(s++))),c+=String.fromCharCode(o<<2|r>>4),64!=i&&(c+=String.fromCharCode(t)),64!=a&&(c+=String.fromCharCode(n));return Xtion_utf8_decode(c)}function Xtion_select_text(e){var t,n;document.body.createTextRange?((n=document.body.createTextRange()).moveToElementText(e),n.select()):window.getSelection&&(t=window.getSelection(),(n=document.createRange()).selectNodeContents(e),t.removeAllRanges(),t.addRange(n))}function Xtion_object_merge(e,t){if(e&&t){for(var n in t)t.hasOwnProperty(n)&&!e[n]&&(e[n]=t[n]);return e}return t||e||{}}function Xtion_form_to_json(e,t){if((t=t||{}).name_prefixing=function(e){return(t.prefix||"")+(t.prefix_remove?e.replace(t.prefix_remove,""):e)},"undefined"!=typeof CKEDITOR)for(var n=e.getElementsByClassName("cke"),o=n.length;o--;)(r=CKEDITOR.instances[n[o].id.substr(4)])&&(r.element.$.value=r.getData());for(var r,i,a,c=t.array?[{}]:t.update||{},s=e.elements||e.querySelectorAll("input,textarea,select"),o=0,p=s.length;o<p;o++)s[o].disabled||(r=t.name_prefixing(s[o].name))&&(i=s[o].value,t.selects_use_text&&"SELECT"===s[o].tagName?i=s[o].options[s[o].selectedIndex].text:"INPUT"===s[o].tagName&&"checkbox"===s[o].type?i=s[o].checked?1:0:"SELECT"===s[o].tagName&&s[o].multiple&&(i=[],s[o].options.forEach(function(e){e.selected&&i.push(e.value)})),i=t.modify&&t.modify[r]?t.modify[r](i):i,t.array?(r=r.replace("[]",""),c[c.length-1][r]?((a={})[r]=i,c.push(a)):c[c.length-1][r]=i):"[]"!==r.substr(-2,2)||s[o].multiple?c[r]=i:(c[r]||(c[r]=[]),c[r].push(i)));if(t.array_all){var l=[{}];for(o in c)if(c[o]instanceof Array)for(var u=0;u<c[o].length;u++)l[u]||(l[u]={}),l[u][o.replace("[]","")]=c[o][u];else l[0][o]=c[o];c=l}return c}function Xtion_json_to_form(e,t,n){n=n||{};var o,r=document.createElement("form"),i=(r.action="javascript:",r.onsubmit=function(){e=Xtion_form_to_json(this,{modify:n.modify,update:e}),t&&t(e,r)},"");for(o in e)if(e.hasOwnProperty(o)&&"string"==typeof e[o])if(n.input&&n.input[o]){var a=n.input[o];if("textarea"===n.input[o]||n.input[o].type&&"textarea"===n.input[o].type)i+="<label>"+o+':<textarea name="'+o+'" class="'+(n.input_classes&&n.input_classes[o]?n.input_classes[o]:"")+'" '+(a.placeholder?' placeholder="'+a.placeholder+'"':"")+">"+Xtion_html_special_chars(e[o])+"</textarea></label>";else if(n.input[o]instanceof Object){var c,s=n.input[o];for(c in i+="<label>"+o+':<select name="'+Xtion_html_special_chars(o)+'">',s)s.hasOwnProperty(c)&&(i+='<option value="'+Xtion_html_special_chars(c)+'"'+(c==e[o]?" selected":"")+">"+Xtion_html_special_chars(s[c])+"</option>");i+="</select></label>"}}else i+="<label>"+o.replace("_"," ")+':<input name="'+o+'" value="'+Xtion_html_special_chars(e[o])+'" type="'+(n.input_types&&n.input_types[o]||"text")+'" class="'+(n.input_classes&&n.input_classes[o]?n.input_classes[o]:"")+'"/></label>';r.innerHTML=(n.prepend||"")+i;var p=document.createElement("input");return p.type="submit",p.value="Submit",r.appendChild(p),r}function Xtion_json_to_form_submit(e,t,n){n=n||{};var o,r=document.createElement("form"),t=(r.setAttribute("action",t),r.setAttribute("method",n.method||"post"),r.className="Xtion_form Xtion_json_to_form_submit",n.pre&&(r.innerHTML+=n.pre),document.createElement("div")),i=(t.className="Xtion_form_output",r.appendChild(t),"");for(o in e)if(e.hasOwnProperty(o)&&"string"==typeof e[o])if(n.input&&n.input[o]){var a=n.input[o];if("textarea"===n.input[o]||n.input[o].type&&"textarea"===n.input[o].type)i+="<label>"+o+':<textarea name="'+o+'" class="'+(n.input_classes&&n.input_classes[o]?n.input_classes[o]:"")+'" '+(a.placeholder?' placeholder="'+a.placeholder+'"':"")+">"+Xtion_html_special_chars(e[o])+"</textarea></label>";else if(n.input[o]instanceof Object){var c=n.input[o];for(s in i+="<label>"+o+':<select name="'+Xtion_html_special_chars(o)+'">',c)c.hasOwnProperty(s)&&(i+='<option value="'+Xtion_html_special_chars(s)+'"'+(s==e[o]?" selected":"")+">"+Xtion_html_special_chars(c[s])+"</option>");i+="</select></label>"}}else i+="<label>"+o.replace("_"," ")+':<input name="'+o+'" value="'+Xtion_html_special_chars(e[o])+'" type="'+(n.input_types&&n.input_types[o]||"text")+'" class="'+(n.input_classes&&n.input_classes[o]?n.input_classes[o]:"")+'"/></label>';else if(e[o]instanceof Object){var s,c=e[o];for(s in i+="<label>"+o+':<select name="'+Xtion_html_special_chars(o)+'">',c)c.hasOwnProperty(s)&&(i+='<option value="'+Xtion_html_special_chars(s)+'">'+Xtion_html_special_chars(c[s])+"</option>");i+="</select></label>"}r.innerHTML+=i;t=document.createElement("input"),t.type="submit",r.appendChild(t),t=new XtionForm;return t.form=r,t.output=r.querySelector(".Xtion_form_output"),t.success_false_function=n.success_false_function,t.success_true_function=n.success_true_function,t.success_true_refresh=n.success_true_refresh,t.Initialize(),r}function Xtion_json_to_inputs_hidden(e){var t,n="";for(t in e)e.hasOwnProperty(t)&&"string"==typeof e[t]&&(n+='<input name="'+t+'" value="'+Xtion_html_special_chars(e[t])+'" type="hidden"/>');return n}function Xtion_form_fill(e,t,n){for(var o=e.elements,r=(n=n||{}).exclude||{submit:1,button:1,hidden:1},i=o.length;i--;)r[o[i].type]||(o[i].multiple&&t[o[i].name]instanceof Array?o[i].options.forEach(function(e){~t[o[i].name].indexOf(e.value)&&(e.selected=!0)}):(o[i].value=t[o[i].name]||"",o[i].onchange&&o[i].onchange()))}function Xtion_form_disable(e,t){for(var n=e.elements||e.querySelectorAll("input,textarea,select"),o=0,r=n.length;o<r;o++)n[o].disabled=!t}function Xtion_url_parameters(e){var t;if(e=void 0===e?location.search:e)return~e.indexOf("?")?(e=e.split("?"))[1]&&(e[0]=e[1]):e=[e],~e[0].indexOf("#")&&(e[0]=e[0].split("#")[0]),e=e[0].split("&"),t={},e.forEach(function(e){e=e.split("="),t[decodeURIComponent(e[0])]=decodeURIComponent(e[1]||"").replace(/\+/g," ")}),JSON.parse(JSON.stringify(t))}function Xtion_query_parameters(e){return Xtion_url_parameters(e)}function Xtion_uri_query_parameters(e){return Xtion_url_parameters(e)}function Xtion_url_parameters_flatten(e,t){var n,o,r,i=[];for(n in e)e.hasOwnProperty(n)&&(o=t?t+"["+n+"]":n,r=e[n],i.push("object"==typeof r?Xtion_url_parameters_flatten(r,o):encodeURIComponent(o)+"="+encodeURIComponent(r)));return i.join("&")}function Xtion_url_parameter_set(e,t){var n,o=t&&1!=t?t:location.href,r=Xtion_url_parameters(o);for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return o=o.split("?")[0]+"?"+Xtion_url_parameters_flatten(r),1==t&&(location.href=o),o}function Xtion_equality(e,t){if(e instanceof Array&&t instanceof Array){if(!e||!t||e.length!=t.length)return!1;for(var n=0,o=e.length;n<o;n++)if(e[n]instanceof Array&&t[n]instanceof Array){if(!Xtion_equality(e[n],t[n]))return!1}else if(e[n]!=t[n])return!1;return!0}return console.error("Xtion_equality Non-Arrays Not Yet Supported"),!1}function Xtion_this_script(){return document.scripts[document.scripts.length-1]}function Xtion_script(e,t){var n=document.querySelector('script[src="'+e+'"]');n?t&&n.addEventListener("load",function(e){t(e)}):((n=document.createElement("script")).src=e,t&&n.addEventListener("load",function(e){t(e)}),(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(n,e))}function Xtion_elements_delete(e){if(e)for(var t=(e=e.tagName?[e]:e).length;t--;)e[t].parentNode.removeChild(e[t])}function Xtion_form_reset(e){e.reset();for(var t=e.querySelectorAll("select"),n=0;n<t.length;n++)t[n].onchange&&t[n].onchange()}function Xtion_object_key_delete(e,t){for(var n in e)~t.indexOf(n)&&delete e[n];return e}function Xtion_string_between(t,n,e,o,r,i){var a=t[o?"lastIndexOf":"indexOf"](n,i||void 0);if(~a){var c=-1;if((e instanceof Array?e:[e]).forEach(function(e){e=t.substr(a+n.length).indexOf(e);~e&&(c=-1===c||e<c?e:c)}),~c){i=t.substr(a+n.length,c);if(!r||""!==i)return i}}return r&&t[o?"lastIndexOf":"indexOf"](n,a+(o?-1:1))?Xtion_string_between(t,n,e,o,r,a+(o?-1:1)):""}function Xtion_image_url_data(e,t){var n=new Image,o=(n.crossOrigin="anonymous",n.src=e,0);n.onload=function(){o||(o=1,window.canvas=document.createElement("canvas"),canvas.width=n.naturalWidth,canvas.height=n.naturalHeight,canvas.getContext("2d").drawImage(n,0,0),t(canvas.toDataURL()))}}function Xtion_image_url_data_xhr(t,n){var o=new XMLHttpRequest;o.open("get",t,!0),o.responseType="arraybuffer",o.send(),o.onreadystatechange=function(){var e;4===o.readyState&&200===o.status&&((e=new FileReader).onload=function(e){n(e.target.result)},e.readAsDataURL(new Blob([o.response],{type:~t.indexOf(".png")?"image/png":"image/jpg"})))}}function Xtion_key_whitelist(t,e){var n={};return e.forEach(function(e){t[e]&&(n[e]=t[e])}),n}function Xtion_string_contains(t,e){var n;return"string"==typeof e?!!~t.indexOf(e):e instanceof Array?(n=!1,e.forEach(function(e){~t.indexOf(e)&&(n=!0)}),n):void console.log("Xtion_string_contains invalid type: "+typeof e)}function Xtion_elements_contain(e,t,n,o){var r=[];return Xtion_foreach(t instanceof Array?t:[t],function(t){Xtion_foreach(e,function(e){(o?e[n?"innerHTML":"textContent"]===t:RegExp(t).test(e[n?"innerHTML":"textContent"]))&&r.push(e)})}),r}function Xtion_foreach(e,t,n){if(e)if(e.constructor===Array)for(var o=0;o<e.length;o++)t(e[o],o,n instanceof Array?n:[]),n&&"object"==typeof e[o]&&Xtion_foreach(e[o],t,n instanceof Array?n.concat([o]):[o]);else for(var r in e)e.hasOwnProperty(r)&&(t(e[r],r,n instanceof Array?n:[]),n)&&"object"==typeof e[r]&&Xtion_foreach(e[r],t,n instanceof Array?n.concat([r]):[r])}function Xtion_parents(e,t,n){if(n=n||{},"number"==typeof t){for(;t--;)e=e.parentNode;return e}if(n.contains)for(;e.parentNode&&e.parentNode.parentNode;){if(e.parentNode.parentNode.querySelector(t))return n.get_selector?e.parentNode.parentNode.querySelector(t):e.parentNode.parentNode;e=e.parentNode}else for(;e.parentNode&&e.parentNode.parentNode;){if(~[].indexOf.call(e.parentNode.parentNode.querySelectorAll(t)||[],e.parentNode))return e.parentNode;e=e.parentNode}return null}function Xtion_element_coordinates(e,t){var e=e.getBoundingClientRect(),n=document.body,o=document.documentElement,r=t?0:window.pageYOffset||o.scrollTop||n.scrollTop,t=t?0:window.pageXOffset||o.scrollLeft||n.scrollLeft,i=o.clientTop||n.clientTop||0,o=o.clientLeft||n.clientLeft||0;return{top:Math.round(e.top+r-i),left:Math.round(e.left+t-o)}}function Xtion_time_ago(e){var t;t=isNaN(e)?(r=new Date,t=new Date(r.getFullYear(),0,1),o=new Date(r.getFullYear(),6,1),r=r.getTimezoneOffset()<Math.max(t.getTimezoneOffset(),o.getTimezoneOffset()),new Date(Date.parse(e.replace(" ","T")+"-0"+(r?"7":"8")+"00"))):new Date(1e3*e);var n,o=864e5,r=new Date-t;return r<6e4?(n=Math.round(r/1e3))+" second"+(1==n?"":"s")+" ago":r<36e5?(n=Math.round(r/6e4))+" minute"+(1==n?"":"s")+" ago":r<o?(n=Math.round(r/36e5))+" hour"+(1==n?"":"s")+" ago":r<2592e6?(n=Math.round(r/o))+" day"+(1==n?"":"s")+" ago":r<31536e6?(n=Math.round(r/2592e6))+" month"+(1==n?"":"s")+" ago":(n=Math.round(r/31536e6))+" year"+(1==n?"":"s")+" ago"}function Xtion_indexesof(e,t){for(var n=[],o=0;o<e.length;o++)e[o]===t&&n.push(o);return n}function Xtion_instr(e,t){if(e){if(!(t instanceof Array))return!!~e.indexOf(t);for(var n=0;n<t.length;n++)if(~e.indexOf(t[n]))return!0}return!1}function Xtion_xpath_element(e,t){return document.evaluate(e,t||document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}function Xtion_xpath_elements(e,t){for(var n=[],o=document.evaluate(e,t||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),r=0,i=o.snapshotLength;r<i;++r)n.push(o.snapshotItem(r));return n}function Xtion_clipboard_copy(e){if(navigator.clipboard)navigator.clipboard.writeText(e).then(function(){},function(e){console.error("Async: Could not copy text: ",e)});else{var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)}}function Xtion_object_indexes(n){var o=!1,r=0,i=arguments;return Xtion_foreach(i,function(e,t){0==t||r||(e instanceof Array?(n=Xtion_object_indexes.apply(null,[n].concat(e)))?t==i.length-1&&(o=!0):r=1:n[e]?(n=n[e],t==i.length-1&&(o=!0)):r=1)}),!!o&&n}function Xtion_object_indexes_flexible(n){var o=!1;return Xtion_foreach(arguments,function(e,t){0!=t&&n[e]&&(n=n[e],t==arguments.length-1)&&(o=!0)}),!!o&&n}function Xtion_request(t,n,r){r="string"==typeof r?{post:r}:r||{};var i,e,o=Object.assign({},r),a=document.getElementsByTagName("html")[0].style,c=(a.cursor="progress",null);if(r.loading_overlay&&(c=Xtion_popup_loading()),r.method=r.method||(r.post||r.files?"POST":"GET"),r.async=void 0===r.async||r.async,r.files){if(r.data=new FormData,r.post)if("string"==typeof r.post&&(r.post=Xtion_url_parameters(r.post)),"object"==typeof r.post)for(var s in r.post)r.post.hasOwnProperty(s)&&r.data.append(s,r.post[s]);else console.log("Request Post data is invalid");for(var s in r.files)r.files.hasOwnProperty(s)&&r.data.append(s,r.files[s])}else r.post&&"object"==typeof r.post&&(r.data||(r.data=r.post instanceof HTMLElement?new FormData(r.post):new FormData),r.post instanceof HTMLElement||(i=function(e,t){for(var n in e){var o;e.hasOwnProperty(n)&&(o=t?t+"["+n+"]":"",e[n]===Object(e[n])?i(e[n],o||n):r.data.append(o||n,e[n]))}})(r.post));window.xtion.csrf&&(e=encodeURIComponent(window.xtion.csrf),r.data?r.data.append("_t",e):r.post?r.post+="&_t="+e:t+=(~t.indexOf("?")?"&":"?")+"_t="+e);var p,l=new XMLHttpRequest,u=(new Date).getTime();if(l.open(r.method||"GET",t,r.async),r.retry&&(p=r.error?r.error.bind():function(){},r.error=function(e){r.retry_count=r.retry_count?r.retry_count+1:1,r.retry_count<=r.retry?setTimeout(function(){Xtion_request(t,n,Object.assign(o,{retry_count:r.retry_count}))},"timeout"===e?0:r.retry_delay||1e3*r.retry_count*2):p(e)}),!r.post||r.data||r.files||r.headers&&r.headers["content-type"]||l.setRequestHeader("content-type","application/x-www-form-urlencoded"),r.headers)for(var _ in r.headers)r.headers.hasOwnProperty(_)&&l.setRequestHeader(_,r.headers[_]);if(r.timeout&&(l.timeout=r.timeout),r.error&&(l.ontimeout=function(){c&&c.close(),a.cursor="",r.error("timeout"),console.log("Request Timeout ("+((new Date).getTime()-u)/1e3+"s)")}),r.response_type&&(l.responseType=r.response_type),r.xhr)for(var d in r.xhr)l[d]=r.xhr[d];l.send(r.data||r.post);function f(){4===l.readyState&&(c&&c.close(),a.cursor="",200===l.status||r.any_status?n&&("function"==typeof n?n(r.response_full?l:"blob"===r.response_type?l.response:l.responseText):"object"==typeof n&&(n.innerHTML=l.responseText)):(r.error&&r.error(l.status),console.log("Request Failed Status "+l.status)))}return r.async?l.onreadystatechange=f:f(),l}function Xtion_request_action(e,t,n){window.xtion.Xtion_request_action_api&&((n=n||{}).post=n.post?Xtion_object_merge(n.post,{api:window.xtion.Xtion_request_action_api}):{api:window.xtion.Xtion_request_action_api}),Xtion_request(window.LOCATION_ACTION+e,t,n)}function Xtion_request_out_save(e){1!=e&&(alert("Error: "+e),console.error(e))}function Xtion_request_out_save_refresh(e,t){1==e?(t?window.top:window).location.reload():(alert("Error: "+e),console.error(e))}function Xtion_request_out_save_refresh_top(e){Xtion_request_out_save_refresh(e,1)}function Xtion_request_out_save_function(e,t){1==e?t():(alert("Error: "+e),console.error(e))}function Xtion_request_out_alert(e){alert(e)}function Xtion_request_out_updated(e){1==e?alert("Updated"):(alert("Error: "+e),console.error(e))}function Xtion_request_out_temporary_popup(e){1==e?Xtion_popup_temporary("Completed"):(alert("Error: "+e),console.error(e))}function Xtion_fetch(t,n,r){r="string"==typeof r?{post:r}:r||{};var i,o,a=Object.assign({},r),c="undefined"!=typeof document?document.getElementsByTagName("html")[0].style:null,s=(c&&(c.cursor="progress"),null);r.loading_overlay&&(s=Xtion_popup_loading()),r.post&&(r.method||(r.method="POST"),"object"==typeof r.post?(r.body||(r.body="undefined"!=typeof HTMLElement&&r.post instanceof HTMLElement?new FormData(r.post):new FormData),"undefined"!=typeof HTMLElement&&r.post instanceof HTMLElement||(i=function(e,t){for(var n in e){var o;e.hasOwnProperty(n)&&(o=t?t+"["+n+"]":"",e[n]===Object(e[n])?i(e[n],o||n):r.body.append(o||n,e[n]))}})(r.post)):r.body=r.post,r.body||r.files||r.headers&&r.headers["content-type"]||(r.headers=r.headers||{},r.headers["content-type"]="application/x-www-form-urlencoded")),(new Date).getTime();return r.retry&&(o=r.error?r.error.bind():function(){},r.error=function(e){r.retry_count=r.retry_count?r.retry_count+1:1,r.retry_count<=r.retry?setTimeout(function(){Xtion_fetch(t,n,Object.assign(a,{retry_count:r.retry_count}))},"timeout"===e?0:r.retry_delay||1e3*r.retry_count*2):o(e)}),fetch(t,r).then(function(e){if(s&&s.close(),c&&(c.cursor=""),200===e.status||r.any_status){if(n)return r.response_full?e:"blob"===r.response_type?e.blob():e.text()}else r.error&&r.error(e.status),console.log("Request Failed Status "+e.status)}).then(function(e){"function"==typeof n?n(e):null!==n&&"object"==typeof n&&(n.innerHTML=e)})}function Xtion_fetch_action(e,t,n){window.xtion.Xtion_fetch_action_api&&((n=n||{}).post=n.post?Xtion_object_merge(n.post,{api:window.xtion.Xtion_fetch_action_api}):{api:window.xtion.Xtion_fetch_action_api}),Xtion_fetch(window.LOCATION_ACTION+e,t,n)}function Xtion_fetch_out_save(e){1!=e&&(alert("Error: "+e),console.error(e))}function Xtion_fetch_out_save_refresh(e,t){1==e?(t?window.top:window).location.reload():(alert("Error: "+e),console.error(e))}function Xtion_fetch_out_save_refresh_top(e){Xtion_fetch_out_save_refresh(e,1)}function Xtion_fetch_out_save_function(e,t){1==e?t():(alert("Error: "+e),console.error(e))}function Xtion_fetch_out_alert(e){alert(e)}function Xtion_fetch_out_updated(e){1==e?alert("Updated"):(alert("Error: "+e),console.error(e))}function Xtion_fetch_out_temporary_popup(e){1==e?Xtion_popup_temporary("Completed"):(alert("Error: "+e),console.error(e))}var Xtion_popups=[];function Xtion_popup(e,t){t=Xtion_object_merge(t,window.xtion.Xtion_popup);var n=e,o=t.target||window,r=t.target?t.target.document:document;if(e&&"object"==typeof e&&e.classList&&e.classList.contains("Xtion_popup_use")){if(e.style.display="",t.info_input)for(var i in t.info||(t.info=""),t.info_input)t.info+='<input type="hidden" name="'+Xtion_html_special_chars(i)+'" value="'+Xtion_html_special_chars(t.info_input[i])+'"/>';t.info&&((l=e.getElementsByClassName("Xtion_popup_content_info"))[0]?l[0].innerHTML=t.info:console.error("Xtion_popup No Info Element")),t.form_reset&&(l=e.getElementsByTagName("form"))&&Xtion_form_reset(l[0]),t.form_fill&&(l=e.getElementsByTagName("form"))&&Xtion_form_fill(l[0],t.form_fill);var a=r.querySelectorAll("body>div.Xtion_popup_container").length;a&&(e.style.zIndex=1e4+a),(l=e.getElementsByClassName("Xtion_popup_content")).length&&(l[0].scrollTop=0)}else{t.group&&(c=(c=t.group.group[t.group.position-1])||t.group.group[t.group.group.length-1],t.previous=r.createElement("button"),t.previous.innerHTML="&#8678;",t.previous.onclick=function(){this.parentNode.parentNode.parentNode.previousSibling.onclick(),Xtion_popup(c.content,c.options_popup)},s=(s=t.group.group[t.group.position+1])||t.group.group[0],t.next=r.createElement("button"),t.next.innerHTML="&#8680;",t.next.onclick=function(){this.parentNode.parentNode.parentNode.previousSibling.onclick(),Xtion_popup(s.content,s.options_popup)}),n=r.createElement("div"),t.id&&(n.id=t.id),n.className="Xtion_popup_container"+(t.container_classes?" "+t.container_classes:""),t.container_click&&n.addEventListener("click",t.container_click),r.body.appendChild(n),0!==t.overlay&&((a=r.createElement("div")).className="Xtion_popup_overlay",0!==t.overlay_close&&(a.onclick=function(){t.overlay_click&&t.overlay_click(),o.Xtion_popup_close(this.parentNode)}),n.appendChild(a));var c,s,a=r.createElement("div"),p=(a.className="Xtion_popup_content_container",a=n.appendChild(a),r.createElement("div"));p.className="Xtion_popup_content"+(t.content_class?" "+t.content_class:""),t.width&&(p.style.width=t.width+"px"),e.substr&&"http"===e.substr(0,4)&&(e='<iframe src="'+e+'"></iframe>'),p=a.appendChild(p),"object"!=typeof e||1!==e.nodeType&&11!==e.nodeType?p.innerHTML+=e:p.appendChild(e),t.next&&content_actions.insertBefore(t.next,content_actions.firstChild),t.previous&&content_actions.insertBefore(t.previous,content_actions.firstChild),t.xtion_detect&&Xtion_detect(p)}a=["Xtion_popup_showing"].concat(t.body_classes?t.body_classes instanceof Array?t.body_classes:t.body_classes.split(" "):[]);a.forEach(function(e){r.body.classList.add(e)});(l=n.querySelector("[data-xtion-focused]"))&&l.focus(),xtion.hook&&xtion.hook.Xtion_popup&&xtion.hook.Xtion_popup.end&&xtion.hook.Xtion_popup.end();var l,e={container:n,body_classes:a,close:function(){o.Xtion_popup_close(n)}};return o.Xtion_popups.push(e),e}function Xtion_popup_close(t){if(!t)if(Xtion_popups.length)t=Xtion_popups[Xtion_popups.length-1];else for(var e=document.getElementsByClassName("Xtion_popup_container"),n=e.length;n--;)if(!e[n].style.display){t=e[n];break}if(t){var o=t.container||t,r={body_classes:["Xtion_popup_showing"]};for(Xtion_popups.forEach(function(e){e.container===t&&(r=e)}),o.classList.contains("Xtion_popup_use")?o.style.display="none":o.parentNode.removeChild(o),r.body_classes.forEach(function(e){document.body.classList.remove(e)}),Xtion_popup_event(o,"close");~Xtion_popups.indexOf(t);)Xtion_popups.splice(Xtion_popups.indexOf(t),1)}}function Xtion_popups_close(){for(var t=document.getElementsByClassName("Xtion_popup_container"),n=t.length;n--;){var o={body_classes:[]};Xtion_popups.forEach(function(e){e.container===t[n]&&(o=e)}),o.body_classes.forEach(function(e){document.body.classList.remove(e)}),t[n].classList.contains("Xtion_popup_use")?t[n].style.display="none":t[n].parentNode.removeChild(t[n]),Xtion_popup_event(t[n],"close")}document.body.classList.remove("Xtion_popup_showing"),window.Xtion_popups_close_extend&&window.Xtion_popups_close_extend(),Xtion_popups=[]}function Xtion_popup_event(e,t){e&&("close"===t?((t=e.getAttribute("data-xtion-close"))&&new Function("e",t)(e),(t=e.getElementsByClassName("Xtion_popup_content_info"))[0]&&(t[0].innerHTML=""),e.style.zIndex=""):console.error("Xtion_popup_event Invalid"))}function Xtion_popup_alert(e){"string"==typeof e&&(e={message:e});var t=document.createDocumentFragment(),e=(e.title&&((n=document.createElement("h1")).innerHTML=e.title,t.appendChild(n)),e.message&&(n=document.createElement("p"),"object"!=typeof(e=e.message)||1!==e.nodeType&&11!==e.nodeType?n.innerHTML+=e:n.appendChild(e),t.appendChild(n)),document.createElement("div")),n=(e.className="Xtion_popup_actions",t.appendChild(e),document.createElement("button"));n.style.width="100%",n.innerHTML="Okay",n.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),Xtion_popup_close(this.parentNode.parentNode.parentNode.parentNode),!1}),e.appendChild(n),Xtion_popup(t,{container_classes:"Xtion_popup_alert_container"})}function Xtion_popup_confirm(e,t){if(null===e)t(1);else{e="string"==typeof e?{message:e}:Xtion_object_merge(e,Xtion_object_merge(xtion.Xtion_popup_confirm,xtion.Xtion_popups));var n,o=document.createDocumentFragment(),r=(e.title&&((n=document.createElement("h1")).innerHTML=e.title,o.appendChild(n)),e.message&&((n=document.createElement("p")).innerHTML=e.message,o.appendChild(n)),document.createElement("div"));if(r.className="Xtion_popup_content_actions",o.appendChild(r),e.actions_extra?(e.actions_extra.unshift(e.actions_okay||"Okay"),e.actions_extra.push(e.actions_cancel||"Cancel")):e.actions_extra=[e.actions_okay||"Okay",e.actions_cancel||"Cancel"],e.actions_extra)for(var i=0;i<e.actions_extra.length;i++){var a=document.createElement("button");a.setAttribute("data-action",i===e.actions_extra.length-1?0:i+1),a.innerHTML=e.actions_extra[i],a.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),Xtion_popup_close(this.parentNode.parentNode.parentNode.parentNode),t(parseInt(this.getAttribute("data-action")),e),!1}),r.appendChild(a)}Xtion_popup(o,{container_classes:"Xtion_popup_confirm_container",cancel_callback:e.cancel_callback})}}function Xtion_popup_prompt(e,t,n){n=n||{};var o=e.type||n.type,r=document.createElement("form"),i=(r.action="javascript:",document.createElement("div")),a=(i.className="Xtion_popup_prompt_inputs",i=r.appendChild(i),document.createElement("label")),c=(a.innerHTML=e.label||e,a=i.appendChild(a),document.createElement("textarea"===o?"textarea":"select"===o?"select":"input")),c=a.appendChild(c),e=("string"!=typeof t&&"number"!=typeof t||(c.value=t),"string"!=typeof n&&"number"!=typeof n||(c.value=n),n.value&&(c.value=n.value),document.createElement("div")),s=(e.className="Xtion_popup_prompt_actions",e=r.appendChild(e),document.createElement("button")),p=(s.innerHTML="Ok",s.onclick=function(){"function"==typeof t&&t(c.value),this.nextSibling.onclick()},e.appendChild(s),c.addEventListener("keydown",function(e){10!=e.keyCode&&13!=e.keyCode||!e.ctrlKey||s.onclick()}),Xtion_popup(r,Xtion_object_merge(n.popup||{},{container_classes:"Xtion_popup_prompt"}))),i=document.createElement("button");return i.innerHTML="Cancel",i.onclick=function(e){p.close()},e.appendChild(i),c.focus(),p}function Xtion_prompt(e,t,n){return Xtion_popup_prompt(e,t,n)}function Xtion_popup_prompt_form(e,t,n){var o=Xtion_popup(Xtion_json_to_form(e,function(e){o.close(),t(e)},n=n||{}),Xtion_object_merge(n.popup||{},{container_classes:"Xtion_popup_prompt_form"}));return o}function Xtion_popup_select(e,r,i){i=i||{};var t,a=document.createDocumentFragment();return i.header&&((t=document.createElement("header")).innerHTML=i.header,a.appendChild(t)),Xtion_foreach(e,function(e,t){e instanceof Object&&(t=void 0!==e[i.key||"key"]?e[i.key||"key"]:t,e=void 0!==e[i.value||"value"]?e[i.value||"value"]:e);var n=document.createElement("div"),o=(n.setAttribute("data-xtion-value",t),document.createElement("a"));o[i.html?"innerHTML":"textContent"]=e,n.appendChild(o),i.suffix&&(n.innerHTML+=i.suffix),n.onclick=function(){r(t,this.textContent),n.offsetParent&&!i.noclose&&Xtion_popup_close(Xtion_parents(n,".Xtion_popup_container"))},a.appendChild(n)}),Xtion_popup(a,Xtion_object_merge(i.popup||{},{container_classes:"Xtion_popup_select"}))}function Xtion_popup_loading(e){e=e||{};var t,n=document.createElement("div");return(e.loading||xtion.loading)&&(n.innerHTML=e.loading||xtion.loading),e.message&&(n.innerHTML+="<p>"+e.message+"</p>"),e.cancel&&((t=document.createElement("button")).innerHTML="Cancel",t.onclick=e.cancel,n.appendChild(t)),Xtion_popup(n,Xtion_object_merge(e.popup||{},{overlay_close:0,container_classes:"Xtion_popup_loading_container"}))}function Xtion_popup_temporary(e,t){var n=Xtion_popup(e,Xtion_object_merge({container_classes:"Xtion_popup_temporary_container"+((t="number"==typeof t?{time:t}:t||{}).class?" "+t.class:""),overlay:0},t));setTimeout(function(){n.container.classList.add("Xtion_popup_temporary_container_animation")},50),setTimeout(function(){n.close()},t.time||5e3)}
